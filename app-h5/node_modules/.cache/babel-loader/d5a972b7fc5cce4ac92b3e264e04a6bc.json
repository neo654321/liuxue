{"ast":null,"code":"import \"vant/es/dialog/style\";\nimport _Dialog from \"vant/es/dialog\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/rate/style\";\nimport _Rate from \"vant/es/rate\";\nimport \"vant/es/stepper/style\";\nimport _Stepper from \"vant/es/stepper\";\nimport \"vant/es/popup/style\";\nimport _Popup from \"vant/es/popup\";\nimport \"vant/es/swipe-item/style\";\nimport _SwipeItem from \"vant/es/swipe-item\";\nimport \"vant/es/swipe/style\";\nimport _Swipe from \"vant/es/swipe\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"vant/es/tabs/style\";\nimport _Tabs from \"vant/es/tabs\";\nimport \"vant/es/tab/style\";\nimport _Tab from \"vant/es/tab\";\nimport \"vant/es/loading/style\";\nimport _Loading from \"vant/es/loading\";\nimport \"vant/es/empty/style\";\nimport _Empty from \"vant/es/empty\";\nimport \"vant/es/image-preview/style\";\nimport _ImagePreview from \"vant/es/image-preview\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { getSellerGoods, getEvaluationList, getSellerInfo, keepGoods, keepGoodsDel, apiEvaluationCountType, apiRecommendAndLike } from \"@/API/commodity\";\nimport { apiGetRecommendNew } from '@/API/home';\nimport { isLogin, priceFormat, getStorage, formatZoneDate, priceFormatInt } from \"@/utils/utis\";\nimport Footer from '@/components/Footer';\nimport VueMarkdown from 'vue-markdown';\nexport default {\n  data() {\n    return {\n      formatZoneDate,\n      priceFormatInt,\n      markdownContent: '',\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      mainColor: process.env.VUE_APP_MAIN_COLOR,\n      sort_index: '',\n      goods_info: {},\n      //商品信息\n      tab_nav_list: [this.$t(\"商品\"), this.$t(\"评价\"), this.$t(\"详情\")],\n      tab_index: 0,\n      swiperWaitTime: 5000,\n      imageList: [],\n      isShippingShow: false,\n      isShowTopBtn: false,\n      EvaluationInfo: [],\n      SellerInfo: {},\n      sellerGoodsId: '',\n      cartNum: 0,\n      //购物车数量\n      bugNum: 1,\n      //购买数量\n      evaluationNum: 0,\n      collectTitle: '',\n      cardShow: false,\n      isCard: false,\n      attributesIndex: [],\n      Token: \"\",\n      isWatch: true,\n      productPropertiesShow: false,\n      activeAttrs: [],\n      allSkus: [],\n      currentSkuTitle: [],\n      currentSkuId: \"-1\",\n      user: {},\n      //\n      attrsIdSkuId: [],\n      defaultSku: [],\n      defaultAvatar: require(\"@/assets/image/default_avatar.png\"),\n      ImagePreview: _ImagePreview,\n      isLoading: false,\n      isEn: getStorage('lang') == 'en',\n      havePicture: '0',\n      mediumReview: '0',\n      negativeComment: '0',\n      positiveComments: '0',\n      recommendedGoods: [],\n      likeGoods: [],\n      currentCoverImg: '',\n      defaultImageList: [],\n      btnDisabled: true,\n      originalPrice: 0,\n      maxBuyNum: localStorage.getItem('maxBuyNum') || 500\n    };\n  },\n  computed: {},\n  components: {\n    Footer,\n    VueMarkdown,\n    // 注册 vue-markdown 组件\n    [_ImagePreview.name]: _ImagePreview,\n    [_Empty.name]: _Empty,\n    [_Loading.name]: _Loading,\n    [_Tab.name]: _Tab,\n    [_Tabs.name]: _Tabs,\n    [_NavBar.name]: _NavBar,\n    [_Swipe.name]: _Swipe,\n    [_SwipeItem.name]: _SwipeItem,\n    [_Popup.name]: _Popup,\n    [_Stepper.name]: _Stepper,\n    [_Rate.name]: _Rate,\n    [_Icon.name]: _Icon,\n    [_Toast.name]: _Toast,\n    [_Dialog.Component.name]: _Dialog.Component\n  },\n  created() {\n    var _this$$route$query;\n    setTimeout(function () {\n      window.scrollTo(0, 0);\n    }, 50);\n    this.loadMarkdownContent();\n    if (this.$route.query.userData) {\n      this.user = JSON.parse(this.$route.query.userData);\n      this.imageList = this.user.imgList;\n      console.log(this.user);\n    }\n    var lang = (_this$$route$query = this.$route.query) === null || _this$$route$query === void 0 ? void 0 : _this$$route$query.lang;\n    if (lang) {\n      switch (lang) {\n        case 'zh-CN':\n          lang = 'cn';\n          break;\n        case 'zh-TW':\n        case 'CN':\n          lang = 'tw';\n          break;\n        case 'en-US':\n          lang = 'en';\n          break;\n        default:\n          lang = 'en';\n          break;\n      }\n      sessionStorage.setItem('backPath', '/');\n      if (lang !== localStorage.getItem('lang')) {\n        localStorage.setItem('lang', lang);\n        location.reload();\n      }\n    }\n    this.sellerGoodsId = this.$route.query.sellerGoodsId.id;\n    console.log(JSON.stringify(this.$route.query.sellerGoodsId));\n  },\n  mounted() {\n    window.addEventListener(\"scroll\", this.handleScroll);\n  },\n  methods: {\n    loadMarkdownContent() {\n      var _this = this;\n      fetch('/1.md').then(function (response) {\n        return response.text();\n      }).then(function (text) {\n        _this.markdownContent = text;\n      }).catch(function (error) {\n        console.error('Error fetching markdown content:', error);\n      });\n    },\n    handleTabsChange(index) {\n      this.tab_index = index;\n      this.toTop(index);\n    },\n    handleToggle(info, index, dis, bool) {\n      var _this$goods_info,\n        _this2 = this;\n      if (dis) return;\n      var disAttr = new Set();\n      var allGood = (_this$goods_info = this.goods_info) === null || _this$goods_info === void 0 || (_this$goods_info = _this$goods_info.canSelectAttributes) === null || _this$goods_info === void 0 ? void 0 : _this$goods_info.goodAttrs;\n      var temparr = JSON.parse(JSON.stringify(this.activeAttrs));\n      if (allGood.length === this.activeAttrs.length) {\n        allGood.forEach(function (item, i) {\n          if (i != index) {\n            item.attrValues.forEach(function (attr, j) {\n              if (attr.attrValueId !== info.attrValueId) {\n                temparr[i] = attr.attrValueId;\n                if (!_this2.getSkusAndPrice(true, temparr)) {\n                  disAttr.add(attr.attrValueId);\n                  _this2.$set(_this2.activeAttrs, index, info.attrValueId);\n                }\n              }\n            });\n          }\n        });\n      }\n      this.$set(this.activeAttrs, index, info.attrValueId);\n      this.getSkusAndPrice();\n      disAttr.clear();\n      this.$forceUpdate();\n      !bool && this.handleToggle(info, index, dis, true);\n    },\n    getSkusAndPrice(find, arr) {\n      // let skuMap = {}\n      // this.allSkus.forEach((item) => {\n      //     const attrIds = item.attrs.map(attr => attr.attrValueId).join(',')\n      //     if (skuMap[attrIds]) return\n      //     skuMap[attrIds] = {\n      //         title: item.attrs.map(attr => attr.attrName && attr.attrValueName ? `${attr.attrName}: ${attr.attrValueName}` : ''),\n      //         coverImg: item.coverImg,\n      //         discountPrice: item.discountPrice,\n      //         sellingPrice: item.sellingPrice,\n      //         skuId: item.skuId,\n      //         img: item?.img || this.defaultImageList,\n      //         hidden: item.hidden,\n      //         price: item.price,\n      //     }\n      // })\n      // const attrIds = find ? arr.join(',') : this.activeAttrs.join(',')\n      // if (skuMap[attrIds] && !find) {\n      //     this.currentSkuTitle = skuMap[attrIds].title\n      //     this.goods_info.discountPrice = skuMap[attrIds].discountPrice || skuMap[attrIds].sellingPrice\n      //     this.currentSkuId = skuMap[attrIds].skuId\n      //     this.currentCoverImg = skuMap[attrIds].coverImg\n      //     this.imageList = skuMap[attrIds].img\n      //     this.btnDisabled = false\n      //     this.originalPrice = skuMap[attrIds].discountPrice ? skuMap[attrIds].price : 0\n      // } else {\n      //     if (Object.keys(skuMap).length === 0) {\n      //         this.btnDisabled = false\n      //     } else {\n      //         this.btnDisabled = true\n      //     }\n      //     return skuMap[attrIds]\n      // }\n    },\n    handleSubmit() {\n      this.getSkusAndPrice();\n      this.isCard ? this.addCart() : this.openPay();\n    },\n    handleScroll() {\n      this.isShowTopBtn = (document.documentElement.scrollTop || document.body.scrollTop) > 500;\n      if (!this.isWatch) return;\n      var EvaluationOffsetTop = this.$el.querySelector(\"#Evaluation\").offsetTop - 50;\n      var detailsOffsetTop = this.$el.querySelector(\"#details\").offsetTop - 50;\n      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;\n      if (scrollTop <= EvaluationOffsetTop) {\n        this.tab_index = 0;\n      } else if (scrollTop >= EvaluationOffsetTop && scrollTop <= detailsOffsetTop) {\n        this.tab_index = 1;\n      } else if (scrollTop >= detailsOffsetTop) {\n        this.tab_index = 2;\n      }\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    //获取商品详情\n    getSellerGoodsInfo(sellerGoodsId) {\n      var _this$$route$query2;\n      this.collectTitle = this.$t('收藏');\n      this.$toast.loading();\n      // 推荐商品/猜你喜欢\n      if (sellerGoodsId) {\n        this.activeAttrs = [];\n        this.allSkus = [];\n        this.goods_info = {};\n        this.imageList = this.defaultImageList = [];\n        scrollTo({\n          top: 0,\n          left: 0,\n          behavior: 'smooth'\n        });\n      }\n      var dataJson = {\n        sellerGoodsId: sellerGoodsId || this.sellerGoodsId,\n        skuId: ((_this$$route$query2 = this.$route.query) === null || _this$$route$query2 === void 0 ? void 0 : _this$$route$query2.skuId) || null\n      };\n    },\n    //获取评论\n\n    jumpAllReviews() {},\n    // 商家详情\n    getSellerInfo(id) {\n      var _this3 = this;\n      var dataJson = {\n        sellerId: id\n      };\n      getSellerInfo(dataJson).then(function (res) {\n        _this3.SellerInfo = res;\n        //详情里添加商铺名称\n        _this3.goods_info.storeName = res.name;\n        _this3.isLoading = false;\n        isLogin() && _this3.requestRecommendedProduct();\n      }).catch(function (err) {\n        console.log(\"err ::->\", err);\n        _this3.isLoading = false;\n      });\n    },\n    checkActive(index) {\n      return index === this.current; // current为监听的轮播index\n    },\n    //监听product轮播index\n    handleChangeSwiper(index) {\n      this.current = index;\n    },\n    onClickLeft() {\n      var backPath = sessionStorage.getItem(\"backPath\");\n      if (backPath) {\n        this.$router.replace('/');\n        sessionStorage.removeItem(\"backPath\");\n      } else {\n        this.$router.go(-1);\n      }\n    },\n    toTop(index) {\n      var _this4 = this;\n      this.isWatch = false;\n      setTimeout(function () {\n        return _this4.isWatch = true;\n      }, 1000);\n      this.tab_index = index;\n      if (index === 0) {\n        this.$el.querySelector(\"#product\").scrollIntoView({\n          block: \"start\",\n          behavior: \"smooth\"\n        });\n      } else if (index === 1) {\n        this.$el.querySelector(\"#Evaluation\").scrollIntoView({\n          block: \"start\",\n          behavior: \"smooth\"\n        });\n      } else {\n        this.$el.querySelector(\"#details\").scrollIntoView({\n          block: \"start\",\n          behavior: \"smooth\"\n        });\n      }\n    },\n    //跳转商铺\n    jumpShop() {\n      sessionStorage.removeItem(\"shopState\");\n      this.$router.push(\"/shop?sellerId=\".concat(this.SellerInfo.id, \"&index=0\"));\n    },\n    //跳转下单\n    openPay() {\n      var _this$goods_info2;\n      if (!isLogin()) {\n        this.productPropertiesShow = false;\n        this.$notifyWarn(this.$t(\"请先登录\"));\n        this.$router.push(\"/login\");\n        return;\n      }\n      if (((_this$goods_info2 = this.goods_info) === null || _this$goods_info2 === void 0 ? void 0 : _this$goods_info2.isShelf) == 0) {\n        this.$notifyWarn(this.$t(\"该商品已下架\"));\n        return;\n      }\n      localStorage.setItem(\"sellerId\", this.goods_info.sellerId);\n      localStorage.setItem(\"storeName\", this.goods_info.storeName);\n      this.goods_info.tempId = new Date().getTime();\n      //type:1直接购买,2购物车购买\n      this.$router.push({\n        path: \"/orderComnfirmation\",\n        query: {\n          skuId: this.currentSkuId,\n          type: 1,\n          goodsInfo: JSON.stringify(this.goods_info),\n          bugNum: this.bugNum,\n          isCart: 0,\n          currentCoverImg: this.currentCoverImg\n        }\n      });\n    },\n    // 打开客服\n    openCustomer() {\n      localStorage.setItem(\"sellerId\", this.goods_info.sellerId);\n      localStorage.setItem(\"storeName\", this.goods_info.storeName);\n      if (isLogin()) {\n        // Toast(this.$t(\"请先登录\"));\n        sessionStorage.setItem('shopName', this.SellerInfo.name);\n        this.$router.push({\n          path: \"/customerServiceIndex?goodsId=\".concat(this.goods_info.id)\n        });\n      } else {\n        this.$notifyWarn(this.$t(\"请先登录\"));\n        this.$router.push(\"/login\");\n      }\n    }\n  },\n  watch: {\n    bugNum(val) {\n      this.cartNum = val;\n    },\n    sort_index() {\n      this.getEvaluationList();\n    },\n    productPropertiesShow(val) {\n      val && (this.swiperWaitTime = 5000);\n    }\n  },\n  beforeDestroy() {\n    window.removeEventListener(\"scroll\", this.handleScroll);\n  },\n  destroyed() {\n    //撤销监听\n    this.$ls.off(\"productList\");\n  }\n};","map":null,"metadata":{},"sourceType":"module"}