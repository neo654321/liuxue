{"ast":null,"code":"import _regeneratorRuntime from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"vant/es/uploader/style\";\nimport _Uploader from \"vant/es/uploader\";\nimport \"vant/es/rate/style\";\nimport _Rate from \"vant/es/rate\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { orderListGoods, orderEvaluationAdd } from '@/API/user';\nimport { priceFormat } from '@/utils/utis';\nimport { uploadimg } from \"@/API/commodity\";\nexport default {\n  name: 'OrderEvaluate',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_Rate.name]: _Rate,\n    [_Uploader.name]: _Uploader\n  },\n  data() {\n    return {\n      mainColor: process.env.VUE_APP_MAIN_COLOR,\n      fileList: [],\n      cancelShow: false,\n      remindShow: false,\n      currentData: null,\n      orderId: null,\n      goodsData: []\n    };\n  },\n  mounted() {\n    var _this = this;\n    this.$nextTick(function () {\n      var id = _this.$route.query.id;\n      if (id) {\n        _this.orderId = id;\n        _this.getOrderGoods();\n      } else {\n        _Toast(_this.$t('订单号不存在'));\n        setTimeout(function () {\n          _this.$router.back();\n        }, 1500);\n      }\n    });\n  },\n  methods: {\n    afterRead(file, _ref) {\n      var _this2 = this;\n      var name = _ref.name;\n      // if('[object Array]' == Object.prototype.toString.call(file)) {\n\n      // }\n      var index = this.goodsData[name].fileList.length; // 图片的索引\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      var formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      var goodsId = '';\n      uploadimg(formData).then(function (data) {\n        console.log('图片上传成功', data);\n        // this.ruleForm.idimg_2 = data\n        _this2.goodsData[name][\"imgUrl\".concat(index)] = data; //待提交图片的索引\n      }).catch(function (error) {\n        _this2.fileList = [];\n        // Toast.fail(this.$t('上传失败'));\n        _this2.$notify(_this2.$t('上传失败'));\n      }).finally(function () {\n        _Toast.clear();\n      });\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    getOrderGoods() {\n      var _this3 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中'),\n        forbidClick: true\n      });\n      orderListGoods({\n        orderId: this.orderId\n      }).then(function (res) {\n        var data = res.pageList || [];\n        data.forEach(function (item) {\n          item.rating = 5;\n          item.content = '';\n        });\n        _this3.goodsData = data;\n        _Toast.clear();\n      }).catch(function () {\n        _Toast.clear();\n      });\n    },\n    submitHandle() {\n      var _this4 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var dataArr, i;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              dataArr = _this4.goodsData.map(function (item) {\n                var rating = item.rating,\n                  content = item.content,\n                  goodsId = item.goodsId;\n                var evaluationType = '1';\n                if (rating < 2) {\n                  evaluationType = '3';\n                } else if (rating < 4) {\n                  evaluationType = '2';\n                } else {\n                  evaluationType = '1';\n                }\n                var obj = {\n                  orderId: _this4.orderId,\n                  sellerGoodsId: goodsId,\n                  rating,\n                  content,\n                  evaluationType\n                };\n                Object.keys(item).forEach(function (key) {\n                  if (key.indexOf('imgUrl') !== -1) {\n                    obj[key] = item[key];\n                  }\n                });\n                return obj;\n              });\n              _Toast.loading({\n                duration: 0,\n                message: _this4.$t('提交中'),\n                forbidClick: true\n              });\n              i = 0;\n            case 3:\n              if (!(i < dataArr.length)) {\n                _context.next = 9;\n                break;\n              }\n              _context.next = 6;\n              return orderEvaluationAdd(dataArr[i]);\n            case 6:\n              i++;\n              _context.next = 3;\n              break;\n            case 9:\n              _Toast.success(_this4.$t('成功'));\n              setTimeout(function () {\n                _this4.$router.back();\n              }, 1000);\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    }\n  }\n};","map":{"version":3,"names":["orderListGoods","orderEvaluationAdd","priceFormat","uploadimg","name","components","_NavBar","_Toast","_Rate","_Uploader","data","mainColor","process","env","VUE_APP_MAIN_COLOR","fileList","cancelShow","remindShow","currentData","orderId","goodsData","mounted","_this","$nextTick","id","$route","query","getOrderGoods","$t","setTimeout","$router","back","methods","afterRead","file","_ref","_this2","index","length","loading","duration","message","forbidClick","formData","FormData","append","goodsId","then","console","log","concat","catch","error","$notify","finally","clear","num","_this3","res","pageList","forEach","item","rating","content","submitHandle","_this4","_asyncToGenerator","_regeneratorRuntime","mark","_callee","dataArr","i","wrap","_callee$","_context","prev","next","map","evaluationType","obj","sellerGoodsId","Object","keys","key","indexOf","success","stop"],"sources":["src/page/Order/Evaluate/index.vue"],"sourcesContent":["<template>\n    <div class=\"page-content\">\n        <van-nav-bar safe-area-inset-top fixed :title=\"$t('评价')\" left-arrow @click-left=\"() => $router.back()\" />\n        <div style=\"width: 100%; height: 46px;\" />\n\n        <div v-if=\"goodsData.length\" class=\"evaluate-content\">\n            <div v-for=\"(item, index) in goodsData\" :key=\"index\" class=\"item\">\n                <div class=\"goods-info\">\n                    <div class=\"poster\">\n                        <img :src=\"item.goodsIcon\" alt=\"\">\n                    </div>\n                    <div class=\"info\">\n                        <p class=\"name\">{{ item.goodsName?.length > 27 ? (item.goodsName.slice(0, 27) + '...') :\n                            item.goodsName }}</p>\n                        <p class=\"price\">$ {{ priceFormat(item.goodsReal) }}</p>\n                        <van-rate class=\"rate-wrap\" v-model=\"item.rating\" :size=\"15\" ::color=\"mainColor\" void-icon=\"star\"\n                            void-color=\"#D9D9D9\" />\n                    </div>\n                </div>\n                <el-input type=\"textarea\" :autosize=\"{ minRows: 3, maxRows: 4 }\" :placeholder=\"$t('请输入评价信息')\" resize=\"none\"\n                    v-model=\"item.content\" maxlength=\"1000\" show-word-limit />\n                <div class=\"evaluate-title\">{{ $t('评价晒图') }}</div>\n                <van-uploader :after-read=\"afterRead\" v-model=\"item.fileList\" :name=\"index\" :max-count=\"9\" accept=\".png,.jpg,.jpeg\" />\n            </div>\n\n            <div class=\"submit-btn\" @click=\"submitHandle\">{{ $t('提交评论') }}</div>\n\n        </div>\n    </div>\n</template>\n\n<script>\nimport { NavBar, Toast, Rate, Uploader } from 'vant'\n\nimport {\n    orderListGoods,\n    orderEvaluationAdd\n} from '@/API/user'\n\nimport {\n    priceFormat\n} from '@/utils/utis'\nimport { uploadimg } from \"@/API/commodity\";\nexport default {\n    name: 'OrderEvaluate',\n    components: {\n        [NavBar.name]: NavBar,\n        [Toast.name]: Toast,\n        [Rate.name]: Rate,\n        [Uploader.name]: Uploader\n    },\n    data() {\n        return {\n            mainColor: process.env.VUE_APP_MAIN_COLOR,\n            fileList: [],\n            cancelShow: false,\n            remindShow: false,\n            currentData: null,\n            orderId: null,\n            goodsData: []\n        }\n    },\n    mounted() {\n        this.$nextTick(() => {\n            const { id } = this.$route.query\n            if (id) {\n                this.orderId = id\n                this.getOrderGoods()\n            } else {\n                Toast(this.$t('订单号不存在'))\n                setTimeout(() => {\n                    this.$router.back()\n                }, 1500);\n            }\n        })\n    },\n    methods: {\n        afterRead(file, { name }) {\n            // if('[object Array]' == Object.prototype.toString.call(file)) {\n                \n            // }\n            let index = this.goodsData[name].fileList.length // 图片的索引\n            Toast.loading({\n                duration: 0,\n                message: this.$t('上传中'),\n                forbidClick: true,\n            })\n            let formData = new FormData();//通过formdata上传\n            formData.append('file', file.file)\n            formData.append('moduleName', 'selle')\n            let goodsId = ''\n            uploadimg(formData).then((data) => {\n                console.log('图片上传成功', data)\n                // this.ruleForm.idimg_2 = data\n                this.goodsData[name][`imgUrl${index}`] = data //待提交图片的索引\n            }).catch((error) => {\n                this.fileList = [];\n                // Toast.fail(this.$t('上传失败'));\n                this.$notify(this.$t('上传失败'))\n            }).finally(() => {\n                Toast.clear()\n            })\n        },\n        priceFormat(num) {\n            return priceFormat(num)\n        },\n        getOrderGoods() {\n            Toast.loading({\n                duration: 0,\n                message: this.$t('请求中'),\n                forbidClick: true\n            })\n\n            orderListGoods({\n                orderId: this.orderId\n            }).then(res => {\n                const data = res.pageList || []\n                data.forEach(item => {\n                    item.rating = 5\n                    item.content = ''\n                })\n                this.goodsData = data\n                Toast.clear()\n            }).catch(() => {\n                Toast.clear()\n            })\n        },\n\n        async submitHandle() {\n            const dataArr = this.goodsData.map(item => {\n                const { rating, content, goodsId } = item\n                let evaluationType = '1'\n                if (rating < 2) {\n                    evaluationType = '3'\n                } else if (rating < 4) {\n                    evaluationType = '2'\n                } else {\n                    evaluationType = '1'\n                }\n                let obj = {\n                    orderId: this.orderId,\n                    sellerGoodsId: goodsId,\n                    rating,\n                    content,\n                    evaluationType\n                }\n                Object.keys(item).forEach(key => {\n                    if (key.indexOf('imgUrl') !== -1) {\n                        obj[key] = item[key]\n                    }\n                })\n                return obj\n            })\n            Toast.loading({\n                duration: 0,\n                message: this.$t('提交中'),\n                forbidClick: true,\n            })\n\n            for (let i = 0; i < dataArr.length; i++) {\n                await orderEvaluationAdd(dataArr[i])\n            }\n\n            Toast.success(this.$t('成功'))\n            setTimeout(() => {\n                this.$router.back()\n            }, 1000)\n        }\n    }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.evaluate-title {\n    font-size: 12px;\n    color: #999999;\n    margin-top: 18px;\n    margin-bottom: 10px;\n}\n\n.page-content {\n    min-height: 100vh;\n    background-color: #F5F5F7;\n\n    * {\n        box-sizing: border-box;\n    }\n\n    /deep/ .el-textarea {\n        textarea:focus {\n            border-color: var(--main-color) !important;\n        }\n    }\n\n    .evaluate-content {\n        padding: 0 15px;\n        padding-bottom: 40px;\n\n        >.item {\n            padding: 18px 24px;\n            background-color: #fff;\n            margin-top: 10px;\n\n            >.goods-info {\n                display: flex;\n                padding-bottom: 15px;\n\n                >.poster {\n                    width: 78px;\n                    height: 78px;\n                    overflow: hidden;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n\n                    >img {\n                        width: 100%;\n                        height: auto;\n                    }\n                }\n\n                >.info {\n                    padding-left: 15px;\n                    flex: 1;\n\n                    >.name {\n                        overflow: hidden;\n                        text-overflow: ellipsis;\n                        display: -webkit-box;\n                        -webkit-box-orient: vertical;\n                        -moz-box-orient: vertical;\n                        box-orient: vertical;\n                        -webkit-line-clamp: 2;\n                        line-clamp: 2;\n                        font-size: 14px;\n                        color: #000;\n                    }\n\n                    >.price {\n                        display: flex;\n                        align-items: center;\n                        margin-top: 10px;\n                        \n                        color: var(--main-color);\n                        font-size: 16px;\n                        font-weight: bold;\n                    }\n                }\n            }\n        }\n\n        >.submit-btn {\n            margin-top: 40px;\n            width: 100%;\n            height: 44px;\n            background: var(--main-color);\n            border-radius: 4px;\n            font-style: normal;\n            font-weight: 400;\n            font-size: 16px;\n            line-height: 44px;\n            text-align: center;\n            color: #FFFFFF;\n        }\n    }\n}\n</style>\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}