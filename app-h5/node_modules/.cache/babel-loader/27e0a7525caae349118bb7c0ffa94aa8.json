{"ast":null,"code":"import _regeneratorRuntime from \"/Users/neo/Desktop/mall_vue/app-h5/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/neo/Desktop/mall_vue/app-h5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport Vcode from \"vue-puzzle-vcode\";\nimport NationalityList from '@/components/NationalityList';\nimport { registerNoVerifcode, justShopRegister, apiSendCode } from '@/API/user';\nimport { isLogin } from '@/utils/utis';\nexport default {\n  name: 'LoginPage',\n  components: {\n    NationalityList,\n    Vcode\n  },\n  data() {\n    return {\n      isLogin,\n      isShelves: !process.env.VUE_APP_PUT_ON_SHELVES,\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      img1: require('@/assets/image/slider/1.png'),\n      img2: require('@/assets/image/slider/2.png'),\n      img3: require('@/assets/image/slider/3.png'),\n      img4: require('@/assets/image/slider/4.png'),\n      img5: require('@/assets/image/slider/5.png'),\n      triangleDown: require('@/assets/image/me/triangle_down.png'),\n      TabShow: ['SM-wholesaleShop', 'FamilyShop'].includes(process.env.VUE_APP_ITEM_NAME) ? 2 : 1,\n      codeBtnTxt: this.$t('码'),\n      formData: {\n        username: '',\n        password: '',\n        re_password: '',\n        verifcode: '',\n        phone: ''\n      },\n      count: 60,\n      interval: null,\n      btnDisabled: false,\n      show: false,\n      pageDiaCode: false,\n      dialCode: localStorage.getItem('dialCode') || 1\n    };\n  },\n  created() {\n    if (this.isLogin()) {\n      this.$router.push('/');\n    }\n  },\n  methods: {\n    getCode() {\n      var _this = this;\n      if (this.formData.username === '') {\n        _Toast(this.$t('请输入邮箱'));\n        return;\n      }\n      var reg = /^([A-Za-z0-9_\\-\\.\\w{3,}])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/;\n      if (!reg.test(this.formData.username)) {\n        _Toast(this.$t('邮箱格式有误'));\n        return;\n      }\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('发送中'),\n        forbidClick: true\n      });\n      var params = {\n        target: this.formData.username\n      };\n      apiSendCode(params).then(function () {\n        _Toast.success(_this.$t('发送成功'));\n        _this.timerFn();\n      }).catch(function (err) {\n        _Toast.clear();\n      });\n    },\n    timerFn() {\n      var _this2 = this;\n      this.codeBtnTxt = \"\".concat(this.$t('再次获取'), \" \").concat(this.count, \" s\");\n      this.btnDisabled = true;\n      this.interval = setInterval(function () {\n        if (_this2.count === 1) {\n          _this2.count = 60;\n          _this2.codeBtnTxt = _this2.$t('再次获取');\n          _this2.btnDisabled = false;\n          clearInterval(_this2.interval);\n        } else {\n          _this2.count -= 1;\n          _this2.codeBtnTxt = \"\".concat(_this2.$t('再次获取'), \" \").concat(_this2.count, \" s\");\n        }\n      }, 1000);\n    },\n    handleJump() {\n      var path = this.$store.state.multiItem[process.env.VUE_APP_ITEM_NAME].customer_service;\n      if (path) {\n        if (window.plus) {\n          window.plus.runtime.openURL(path);\n        } else {\n          window.open(path);\n        }\n      } else {\n        this.$router.push({\n          path: \"customerServiceIndex?path=customerService\"\n        });\n      }\n    },\n    TabClick(e) {\n      this.TabShow = e;\n      this.formData.username = '';\n      this.formData.password = '';\n      this.formData.re_password = '';\n    },\n    post_form() {\n      var t = this;\n      if (this.TabShow === 1) {\n        if (this.formData.username === '') {\n          _Toast(t.$t('请输入手机号'));\n          return;\n        } else {\n          var _reg = /^[0-9]+[0-9]*$/;\n          if (!_reg.test(this.formData.username)) {\n            _Toast(t.$t('手机号格式有误'));\n            return;\n          }\n        }\n      }\n      if (this.TabShow === 2) {\n        if (this.formData.username === '') {\n          _Toast(t.$t('请输入邮箱'));\n          return;\n        }\n        var _reg2 = /^([A-Za-z0-9_\\-\\.\\w{3,}])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,4})$/;\n        if (!_reg2.test(this.formData.username)) {\n          _Toast(t.$t('邮箱格式有误'));\n          return;\n        }\n      }\n      if (this.formData.password === '') {\n        _Toast(t.$t('请输入密码'));\n        return;\n      }\n      var reg = /^[a-zA-Z0-9!@#$%^&*()_+{}\\[\\]:;'\"\\\\|,.<>?~`\\-=/]{6,12}$/;\n      if (!reg.test(this.formData.password)) {\n        _Toast(t.$t('请输入 6-12 位由数字或字母组成的密码'));\n        return;\n      }\n      if (this.formData.password !== this.formData.re_password) {\n        _Toast(this.$t('两次密码输入不一致'));\n        return;\n      }\n      this.show = true;\n    },\n    onSuccess() {\n      this.registerSubmit();\n      this.show = false;\n    },\n    onFail() {\n      console.log(\"失败回调\");\n    },\n    registerSubmit() {\n      var _this3 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _encodeURIComponent, _encodeURIComponent2;\n        var requestFn, params;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              requestFn = ['SM-wholesaleShop', 'FamilyShop'].includes(_this3.itemName) ? justShopRegister : registerNoVerifcode;\n              params = {\n                password: (_encodeURIComponent = encodeURIComponent(_this3.formData.password)) === null || _encodeURIComponent === void 0 ? void 0 : _encodeURIComponent.trim(),\n                re_password: (_encodeURIComponent2 = encodeURIComponent(_this3.formData.re_password)) === null || _encodeURIComponent2 === void 0 ? void 0 : _encodeURIComponent2.trim(),\n                type: _this3.TabShow\n              };\n              if (sessionStorage.getItem('ac_code')) {\n                params.agentCode = sessionStorage.getItem('ac_code');\n                sessionStorage.removeItem('ac_code');\n              }\n              if (['SM-wholesaleShop', 'FamilyShop'].includes(_this3.itemName)) {\n                params.verifcode = _this3.formData.verifcode;\n                params.phone = _this3.formData.phone;\n                params.username = _this3.formData.username.trim();\n              } else {\n                params.username = _this3.TabShow === 1 ? \"\".concat(_this3.dialCode, \" \").concat(_this3.formData.username.trim()) : _this3.formData.username.trim();\n              }\n              _Toast.loading({\n                duration: 0,\n                message: _this3.$t('提交中'),\n                forbidClick: true\n              });\n              requestFn(params).then( /*#__PURE__*/function () {\n                var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(res) {\n                  var timeZone;\n                  return _regeneratorRuntime().wrap(function _callee$(_context) {\n                    while (1) switch (_context.prev = _context.next) {\n                      case 0:\n                        // Toast.success(this.$t('注册成功'))\n                        _Toast.clear();\n                        _this3.$notify(_this3.$t('注册成功'), 'success');\n                        localStorage.setItem('token', res.token);\n                        timeZone = _this3.dayjs.tz.guess();\n                        localStorage.setItem(\"timeZone\", timeZone);\n                        _context.next = 7;\n                        return _this3.$store.dispatch('getUserInfo');\n                      case 7:\n                        _this3.$router.push({\n                          path: '/'\n                        });\n                      case 8:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }, _callee);\n                }));\n                return function (_x) {\n                  return _ref.apply(this, arguments);\n                };\n              }()).catch(function (err) {\n                // Toast.fail(err.msg)\n                _Toast.clear();\n              });\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }))();\n    },\n    getName(params) {\n      if (!this.pageDiaCode) {\n        this.pageDiaCode = true;\n      } else {\n        this.dialCode = params[2];\n        localStorage.setItem('dialCode', this.dialCode);\n      }\n    },\n    openNational() {\n      this.$refs.controlChild.open();\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}