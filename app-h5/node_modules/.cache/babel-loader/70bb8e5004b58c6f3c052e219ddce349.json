{"ast":null,"code":"import _regeneratorRuntime from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"vant/es/uploader/style\";\nimport _Uploader from \"vant/es/uploader\";\nimport \"vant/es/rate/style\";\nimport _Rate from \"vant/es/rate\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { orderListGoods, orderEvaluationAdd } from '@/API/user';\nimport { priceFormat } from '@/utils/utis';\nimport { uploadimg } from \"@/API/commodity\";\nexport default {\n  name: 'OrderEvaluate',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_Rate.name]: _Rate,\n    [_Uploader.name]: _Uploader\n  },\n  data() {\n    return {\n      mainColor: process.env.VUE_APP_MAIN_COLOR,\n      fileList: [],\n      cancelShow: false,\n      remindShow: false,\n      currentData: null,\n      orderId: null,\n      goodsData: []\n    };\n  },\n  mounted() {\n    var _this = this;\n    this.$nextTick(function () {\n      var id = _this.$route.query.id;\n      if (id) {\n        _this.orderId = id;\n        _this.getOrderGoods();\n      } else {\n        _Toast(_this.$t('订单号不存在'));\n        setTimeout(function () {\n          _this.$router.back();\n        }, 1500);\n      }\n    });\n  },\n  methods: {\n    afterRead(file, _ref) {\n      var _this2 = this;\n      var name = _ref.name;\n      // if('[object Array]' == Object.prototype.toString.call(file)) {\n\n      // }\n      var index = this.goodsData[name].fileList.length; // 图片的索引\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      var formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      var goodsId = '';\n      uploadimg(formData).then(function (data) {\n        console.log('图片上传成功', data);\n        // this.ruleForm.idimg_2 = data\n        _this2.goodsData[name][\"imgUrl\".concat(index)] = data; //待提交图片的索引\n      }).catch(function (error) {\n        _this2.fileList = [];\n        // Toast.fail(this.$t('上传失败'));\n        _this2.$notify(_this2.$t('上传失败'));\n      }).finally(function () {\n        _Toast.clear();\n      });\n    },\n    priceFormat(num) {\n      return priceFormat(num);\n    },\n    getOrderGoods() {\n      var _this3 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中'),\n        forbidClick: true\n      });\n      orderListGoods({\n        orderId: this.orderId\n      }).then(function (res) {\n        var data = res.pageList || [];\n        data.forEach(function (item) {\n          item.rating = 5;\n          item.content = '';\n        });\n        _this3.goodsData = data;\n        _Toast.clear();\n      }).catch(function () {\n        _Toast.clear();\n      });\n    },\n    submitHandle() {\n      var _this4 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var dataArr, i;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              dataArr = _this4.goodsData.map(function (item) {\n                var rating = item.rating,\n                  content = item.content,\n                  goodsId = item.goodsId;\n                var evaluationType = '1';\n                if (rating < 2) {\n                  evaluationType = '3';\n                } else if (rating < 4) {\n                  evaluationType = '2';\n                } else {\n                  evaluationType = '1';\n                }\n                var obj = {\n                  orderId: _this4.orderId,\n                  sellerGoodsId: goodsId,\n                  rating,\n                  content,\n                  evaluationType\n                };\n                Object.keys(item).forEach(function (key) {\n                  if (key.indexOf('imgUrl') !== -1) {\n                    obj[key] = item[key];\n                  }\n                });\n                return obj;\n              });\n              _Toast.loading({\n                duration: 0,\n                message: _this4.$t('提交中'),\n                forbidClick: true\n              });\n              i = 0;\n            case 3:\n              if (!(i < dataArr.length)) {\n                _context.next = 9;\n                break;\n              }\n              _context.next = 6;\n              return orderEvaluationAdd(dataArr[i]);\n            case 6:\n              i++;\n              _context.next = 3;\n              break;\n            case 9:\n              _Toast.success(_this4.$t('成功'));\n              setTimeout(function () {\n                _this4.$router.back();\n              }, 1000);\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}