{"ast":null,"code":"import _defineProperty from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/popup/style\";\nimport _Popup from \"vant/es/popup\";\nimport \"vant/es/cell-group/style\";\nimport _CellGroup from \"vant/es/cell-group\";\nimport \"vant/es/cell/style\";\nimport _Cell from \"vant/es/cell\";\nimport \"vant/es/stepper/style\";\nimport _Stepper from \"vant/es/stepper\";\nimport \"vant/es/checkbox-group/style\";\nimport _CheckboxGroup from \"vant/es/checkbox-group\";\nimport \"vant/es/checkbox/style\";\nimport _Checkbox from \"vant/es/checkbox\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\nimport \"vant/es/list/style\";\nimport _List from \"vant/es/list\";\nvar _components;\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport { dizhi_liebiao_post } from \"@/API/user\";\nimport { orderSubmit } from \"@/API/commodity\";\nimport { ref } from \"vue\";\nimport { priceFormat } from '@/utils/utis';\n// import EnterPassword from \"@/components/EnterPassword/index.vue\";\nimport Big from 'big.js';\nexport default {\n  setup: function setup() {\n    var checked = ref([\"a\", \"b\"]);\n    var checkedAll = ref(false);\n    var checkboxGroup = ref(null);\n    var checkAll = function checkAll() {\n      checkboxGroup.value.toggleAll(true);\n    };\n    return {\n      checked: checked,\n      checkedAll: checkedAll,\n      checkAll: checkAll,\n      checkboxGroup: checkboxGroup\n    };\n  },\n  data: function data() {\n    return {\n      priceFormat: priceFormat,\n      type: 2,\n      //1直接购买,2购物车购买\n      goodsInfo: {},\n      //单个商品信息\n      bugNum: 1,\n      //单个商品选中的数量\n      refreshing: false,\n      paymentChecked: [],\n      checkboxList: [{\n        key: 0,\n        title: \"Blance\",\n        icon: \"\",\n        open: true\n      }, {\n        key: 1,\n        title: \"PayPal\",\n        icon: \"\",\n        open: false\n      }, {\n        key: 2,\n        title: \"Visa\",\n        icon: \"\",\n        open: false\n      }, {\n        key: 3,\n        title: \"Masercard\",\n        icon: \"\",\n        open: false\n      }],\n      list: [],\n      addressList: [],\n      addressInfo: {},\n      orderList: [],\n      total: {},\n      //金额计算数据\n      skuId: \"\",\n      attributes: [],\n      currentCoverImg: '',\n      maxBuyNum: localStorage.getItem('maxBuyNum') || 500\n    };\n  },\n  components: (_components = {}, _defineProperty(_components, _List.name, _List), _defineProperty(_components, _PullRefresh.name, _PullRefresh), _defineProperty(_components, _Checkbox.name, _Checkbox), _defineProperty(_components, _CheckboxGroup.name, _CheckboxGroup), _defineProperty(_components, _Stepper.name, _Stepper), _defineProperty(_components, _Cell.name, _Cell), _defineProperty(_components, _CellGroup.name, _CellGroup), _defineProperty(_components, _Popup.name, _Popup), _defineProperty(_components, _Icon.name, _Icon), _defineProperty(_components, _Toast.name, _Toast), _components),\n  created: function created() {\n    //获取路由参数\n    try {\n      var _this$$route$query = this.$route.query,\n        type = _this$$route$query.type,\n        goodsInfo = _this$$route$query.goodsInfo,\n        bugNum = _this$$route$query.bugNum,\n        currentCoverImg = _this$$route$query.currentCoverImg;\n      this.currentCoverImg = currentCoverImg;\n      this.type = type;\n      this.goodsInfo = JSON.parse(goodsInfo);\n      this.bugNum = bugNum;\n    } catch (e) {\n      console.log(e);\n    }\n    this.dizhiliebiao();\n    //跳转商品展示\n    this.getProduct();\n    this.init();\n  },\n  methods: {\n    init: function init() {\n      //全选\n      if (this.list.length > 0) {\n        this.list.forEach(function (item) {\n          item.checkedAll = true;\n          if (item.child.length > 0) {\n            item.checkedValue = item.child.map(function (child) {\n              return child === null || child === void 0 ? void 0 : child.tempId;\n            });\n          }\n        });\n      }\n      //计算总金额\n      this.mathMoney();\n    },\n    mathMoney: function mathMoney() {\n      var _this = this;\n      this.total = {\n        money: 0,\n        piece: 0,\n        discount: 0,\n        freight: 0,\n        goodsTax: 0,\n        mathMoney: 0,\n        discountPrice: 0\n      };\n      var count = 0;\n      this.list.forEach(function (item) {\n        count += item.checkedValue.length;\n        // this.total.piece = item.checkedValue.length\n        item.child.length > 0 && item.child.forEach(function (child) {\n          //num<item.moreNum&&\n          if (item.checkedValue.includes(child.tempId)) {\n            _this.total.money = _this.$plus(_this.total.money, _this.$operation(child.price, child.count, 'times'));\n            _this.total.freight = _this.$plus(_this.total.freight, _this.$operation(child.freightAmount, child.count, 'times'));\n            _this.total.goodsTax = _this.$plus(_this.total.goodsTax, _this.$operation(child.goodsTax, child.count, 'times'));\n          }\n        });\n      });\n      this.total.piece = count;\n      this.total.mathMoney = new Big(this.total.money).plus(this.total.freight).plus(this.total.goodsTax).minus(this.total.discount);\n      this.total.mathMoney = priceFormat(this.total.mathMoney);\n    },\n    getProduct: function getProduct() {\n      var _this2 = this;\n      if (this.type == 1) {\n        if (this.$route.query.skuId !== \"-1\") {\n          this.skuId = this.$route.query.skuId || 0;\n          this.attributes = this.goodsInfo.canSelectAttributes.skus.filter(function (i) {\n            return i.skuId == _this2.skuId;\n          })[0];\n        }\n\n        // console.log(\"attributes ->\", attributes);\n        var item = {\n          key: 0,\n          sort: this.goodsInfo.storeName,\n          checkedAll: false,\n          checkedValue: [],\n          moreNum: 2,\n          child: [{\n            key: 1,\n            img: this.goodsInfo.imgUrl1 || this.$defaultGoodsImage,\n            price: this.goodsInfo.discountPrice ? this.goodsInfo.discountPrice : this.goodsInfo.sellingPrice,\n            describe: this.goodsInfo.name,\n            attributes: this.attributes || [],\n            count: this.bugNum,\n            id: this.goodsInfo.id,\n            freightAmount: this.goodsInfo.freightAmount,\n            goodsTax: this.goodsInfo.goodsTax\n          }]\n        };\n        this.list.push(item);\n      } else {\n        //   console.log(\"this.goodsInfo ->\", this.list);\n        this.list = this.$ls.get(\"cartList\");\n      }\n    },\n    // 单选\n    handlecheckItemClick: function handlecheckItemClick(item, index, n) {\n      var _this3 = this;\n      if (this.list[index].child[n].selected == undefined) this.list[index].child[n].selected = true;\n      this.list[index].child[n].selected = !this.list[index].child[n].selected;\n      var count = 0;\n      var num = 0;\n      var len = this.list[index].child.length;\n      this.list[index].child.forEach(function (sub) {\n        if (sub.selected) count += 1;else num += 1;\n        if (num == len) _this3.list[index].checkedAll = false;\n        if (count != 0) _this3.list[index].checkedAll = true;\n      });\n    },\n    //类全选\n    handleCheckItemAll: function handleCheckItemAll(value, index) {\n      var _this4 = this;\n      this.list[index].checkedValue = [];\n      this.$nextTick(function () {\n        _this4.list[index].child.forEach(function (item, num) {\n          item.selected = value;\n          value && _this4.list[index].checkedValue.push(item.tempId);\n        });\n      });\n      // this.list[index].checkedValue = [];\n      // if (value) {\n      //   this.list[index].child.forEach((item, num) => {\n      //     if (num < this.list[index].moreNum) {\n      //       this.list[index].checkedValue.push(item.id);\n      //     }\n      //   });\n      // }\n      this.mathMoney();\n    },\n    onRefresh: function onRefresh() {\n      // 清空列表数据\n      this.finished = false;\n      this.loading = true;\n      this.onLoad();\n    },\n    onLoad: function onLoad() {\n      if (this.refreshing) {\n        this.refreshing = false;\n      }\n    },\n    onClickLeft: function onClickLeft() {\n      this.$router.go(-1);\n      // this.$router.push({ path: \"/cart\" });\n    },\n    // 确认\n    handleConfri: function handleConfri() {\n      var _this5 = this;\n      if (!(this.total.piece > 0)) {\n        _Toast(this.$t(\"请选择要购买的商品\"));\n        return;\n      }\n      var dataJson = {\n        orderInfo: \"\",\n        addressId: this.addressInfo.id\n      };\n      if (this.type == 1) {\n        dataJson.orderInfo = \"\".concat(this.goodsInfo.id, \",\").concat(this.$route.query.skuId || \"-1\", \",\").concat(this.list[0].child[0].count);\n      } else {\n        this.list.forEach(function (item) {\n          item.child.length > 0 && item.child.forEach(function (child) {\n            if (item.checkedValue.includes(child.tempId)) {\n              dataJson.orderInfo += \"\".concat(child.id, \",\").concat((child === null || child === void 0 ? void 0 : child.skuId) || \"-1\", \",\").concat(child.count, \",\");\n            }\n          });\n        });\n      }\n      orderSubmit(dataJson).then(function (res) {\n        var _this5$$route$query;\n        _this5.orderList = res.orderList;\n        var productList = _this5.$ls.get(\"productList\") || [];\n        var ids = [];\n        productList === null || productList === void 0 ? void 0 : productList.forEach(function (item) {\n          _this5.list.forEach(function (_ref) {\n            var child = _ref.child;\n            child.forEach(function (_ref2) {\n              var id = _ref2.id,\n                selected = _ref2.selected;\n              if (id == item.id && selected) ids.push(id);\n            });\n          });\n        });\n        _this5.$router.push({\n          path: \"/PendingPayment\",\n          query: {\n            orderList: JSON.stringify(_this5.orderList),\n            total: _this5.total.mathMoney,\n            ids: ids,\n            isCart: ((_this5$$route$query = _this5.$route.query) === null || _this5$$route$query === void 0 ? void 0 : _this5$$route$query.isCart) || 0\n          }\n        });\n        // this.pwtStatus=true\n      });\n    },\n    //获取地址列表\n    dizhiliebiao: function dizhiliebiao() {\n      var _this6 = this;\n      dizhi_liebiao_post({}).then(function (res) {\n        var _res$pageList, _res$pageList$;\n        if (!((_res$pageList = res.pageList) !== null && _res$pageList !== void 0 && (_res$pageList$ = _res$pageList[0]) !== null && _res$pageList$ !== void 0 && _res$pageList$.country)) return;\n        _this6.addressList = res.pageList;\n        var address = JSON.parse(_this6.$ls.get(\"address\"));\n        if (address) {\n          _this6.addressInfo = address;\n          _this6.$ls.remove(\"address\");\n          return;\n        }\n        _this6.addressList.map(function (item) {\n          item.phone = item.phone.indexOf(\"|\") > -1 ? item.phone.split(\"|\")[1] : item.phone;\n          if (item.use === 1) {\n            _this6.addressInfo = item;\n          }\n        });\n      })[\"catch\"](function () {});\n    },\n    openAddress: function openAddress() {\n      this.$router.push(\"/AddressList?c=1\");\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}