{"ast":null,"code":"import \"vant/es/image-preview/style\";\nimport _ImagePreview from \"vant/es/image-preview\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport { rechargeBlockchainDetails } from \"@/API/user\";\nimport { getImgUrl, priceFormat } from '@/utils/utis';\nimport QRCode from 'qrcode';\nexport default {\n  name: 'rechargeRecordDetails',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_ImagePreview.Component.name]: _ImagePreview.Component\n  },\n  data() {\n    return {\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      pageDone: false,\n      orderNo: null,\n      dataInfo: null,\n      previewShow: false,\n      previewImages: [],\n      codeImgUrl: '',\n      priceFormat\n    };\n  },\n  mounted() {\n    var _this = this;\n    this.$nextTick(function () {\n      var _this$$route$query = _this.$route.query,\n        order_no = _this$$route$query.order_no,\n        failure_msg = _this$$route$query.failure_msg;\n      if (order_no) {\n        _this.orderNo = order_no;\n        _this.failureMsg = failure_msg;\n        _this.getDataInfo();\n      } else {\n        _Toast(_this.$t('订单号不存在'));\n      }\n    });\n  },\n  methods: {\n    onClickLeft() {\n      this.$router.go(-1);\n    },\n    copyData(ea) {\n      var _this2 = this;\n      this.$copyText(ea).then(function () {\n        _Toast(_this2.$t('复制成功'));\n      }, function () {\n        _Toast(_this2.$t('复制失败'));\n      });\n    },\n    getDataInfo() {\n      var _this3 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中')\n      });\n      rechargeBlockchainDetails({\n        order_no: this.orderNo\n      }).then(function (res) {\n        res.stateStr = '';\n        res.className = '';\n        if (res.state === 0) {\n          res.stateStr = _this3.$t('处理中');\n        }\n        if (res.state === 1) {\n          res.className = 'success';\n          res.stateStr = _this3.$t('成功');\n        }\n        if (res.state === 2) {\n          res.className = 'fail';\n          res.stateStr = _this3.$t('失败');\n        }\n        if (res.img) {\n          _this3.previewImages = [res.img];\n        }\n        _this3.dataInfo = res;\n        _this3.pageDone = true;\n        _Toast.clear();\n        _this3.$nextTick(function () {\n          _this3.createCodeImg(res.from);\n        });\n      }).catch(function (err) {\n        // Toast(err.msg)\n        _Toast.clear();\n      });\n    },\n    // 生成二维码\n    createCodeImg(txt) {\n      var that = this;\n      var canvas = document.getElementById('canvas');\n      QRCode.toCanvas(canvas, txt, {\n        width: 124,\n        height: 124,\n        margin: 0\n      }, function (error) {\n        if (error) {\n          // console.error(error)\n        } else {\n          that.codeImgUrl = canvas.toDataURL('image/png');\n        }\n      });\n    },\n    saveCodeImg() {\n      var myCanvas = document.getElementsByTagName('canvas');\n      this.imgUrl = myCanvas[0].toDataURL('image/png');\n      this.getUrlBase64(this.imgUrl).then(function (base64) {\n        var link = document.createElement('a');\n        link.href = base64;\n        link.download = 'qrCode.png';\n        link.click();\n      });\n    },\n    getUrlBase64(url) {\n      return new Promise(function (resolve) {\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n        var img = new Image();\n        img.crossOrigin = 'Anonymous'; //允许跨域\n        img.src = url;\n        img.onload = function () {\n          canvas.height = 300;\n          canvas.width = 300;\n          ctx.drawImage(img, 0, 0, 300, 300);\n          var dataURL = canvas.toDataURL('image/png');\n          canvas = null;\n          resolve(dataURL);\n        };\n      });\n    },\n    getImgUrlHandle(path) {\n      console.log(\"path ::->\", path);\n      return getImgUrl(path);\n    },\n    toPay(path) {\n      window.open(path);\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;AA8EA;AACA;AACA;AACA;EACAA;EACAC;IACA;IACA;IACA;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IAAA;IACA;MACA;QAAAC;QAAAC;MACA;QACA;QACA;QACA;MACA;QACA;MACA;IACA;EACA;EACAC;IACAC;MACA;IACA;IACAC;MAAA;MACA;QACA;MACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QACAC;QACAC;MACA;MACAC;QAAAR;MAAA;QACAS;QACAA;QACA;UACAA;QACA;QACA;UACAA;UACAA;QACA;QACA;UACAA;UACAA;QACA;QACA;UACA;QACA;QACA;QACA;QACA;QACA;UACA;QACA;MACA;QACA;QACA;MACA;IACA;IACA;IACAC;MACA;MACA;MACAC,6BACA;QACAC;QACAC;QACAC;MACA;QACA;UACA;QAAA,CACA;UACAC;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;QACA;QACAC;QACAA;QACAA;MACA;IACA;IACAC;MACA;QACA;QACA;QACA;QACAC;QACAA;QACAA;UACAC;UACAA;UACAC;UACA;UACAD;UACAE;QACA;MACA;IACA;IACAC;MACAC;MACA;IACA;IACAC;MACAC;IACA;EACA;AACA","names":["name","components","data","itemName","pageDone","orderNo","dataInfo","previewShow","previewImages","codeImgUrl","priceFormat","mounted","order_no","failure_msg","methods","onClickLeft","copyData","getDataInfo","duration","message","rechargeBlockchainDetails","res","createCodeImg","QRCode","width","height","margin","that","saveCodeImg","link","getUrlBase64","img","canvas","ctx","resolve","getImgUrlHandle","console","toPay","window"],"sourceRoot":"src/page/recharge/RecordDetails","sources":["index.vue"],"sourcesContent":["<template>\n    <div class=\"page-content\">\n        <van-image-preview v-if=\"previewImages.length\" v-model=\"previewShow\" :images=\"previewImages\"></van-image-preview>\n\n        <van-nav-bar safe-area-inset-top fixed :title=\"$t('充值详情')\" left-arrow @click-left=\"onClickLeft\" />\n        <div style=\"width: 100%;\" class=\"h46\"></div>\n\n        <div v-if=\"pageDone && dataInfo\" class=\"info-content\">\n            <div class=\"order-info-content\">\n                <div class=\"item\">\n                    <p>{{ $t('订单号') }}：</p>\n                    <div class=\"copy\" @click=\"copyData(dataInfo.order_no)\">\n                        <span style=\"text-align: end;\">{{ dataInfo.order_no }}</span>\n                        <img src=\"@/assets/image/me/fuzhi1.png\" />\n                    </div>\n                </div>\n                <div class=\"item\">\n                    <p>{{ $t('创建时间') }}：</p>\n                    <div>{{ dataInfo.create_time }}</div>\n                </div>\n                <div class=\"item\">\n                    <p>{{ $t('充值数量') }}：</p>\n                    <div class=\"money\">{{ dataInfo.volume > 1 ? priceFormat(dataInfo.volume) : dataInfo.volume }} {{\n                        dataInfo.coin }}</div>\n                </div>\n                <div class=\"item\">\n                    <p>{{ $t('实际到账') }}：</p>\n                    <div class=\"money\" v-if=\"priceFormat(dataInfo.amount)\">{{ priceFormat(dataInfo.amount) }} USDT</div>\n                    <div class=\"money\" v-else>--</div>\n                </div>\n\n                <div class=\"item\">\n                    <p>{{ $t('订单状态') }}：</p>\n                    <div class=\"money\" :class=\"dataInfo.className\">{{ dataInfo.stateStr }}</div>\n                </div>\n                <div class=\"item\" v-if=\"dataInfo.state == 2\">\n                    <p>{{ $t('失败原因') }}：</p>\n                    <div class=\"money\" :class=\"dataInfo.className\">{{ dataInfo.failureMsg || '--' }}</div>\n                </div>\n                <div class=\"item\" v-if=\"dataInfo.coin_blockchain\">\n                    <p>{{ $t('币种协议') }}：</p>\n                    <div>{{ dataInfo.coin_blockchain }}</div>\n                </div>\n                <div class=\"item no-border\" v-if=\"dataInfo.channel_address\">\n                    <p>{{ $t('收款地址') }}：</p>\n                    <div class=\"copy\" @click=\"copyData(dataInfo.channel_address)\">\n                        <span>{{ dataInfo.channel_address }}</span>\n                        <img src=\"@/assets/image/me/fuzhi1.png\" />\n                    </div>\n                </div>\n                <div class=\"item code-img\" v-if=\"codeImgUrl\">\n                    <div class=\"code-img-content\">\n                        <canvas id=\"canvas\" style=\"display:none\"></canvas>\n                        <img :src=\"codeImgUrl\" class=\"canvas\" />\n                    </div>\n                    <div class=\"btn\">\n                        <div @click=\"saveCodeImg\">{{ $t('保存二维码') }}</div>\n                    </div>\n                </div>\n                <div class=\"item center\" v-if=\"dataInfo.img\">\n                    <p>{{ $t('支付凭证') }}：</p>\n                    <div class=\"copy\">\n                        <div class=\"img-content\" @click=\"previewShow = true\">\n                            <img :src=\"dataInfo.img\" alt=\"\">\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <!-- Shop2u 未处理跳转支付按钮 -->\n            <van-button block type=\"primary\" v-if=\"itemName == 'Shop2u' && dataInfo.state == 0 && dataInfo.payUrl\"\n                class=\"pay_btn\" @click=\"toPay(dataInfo.payUrl)\">\n                {{ $t('立即支付') }}\n            </van-button>\n        </div>\n    </div>\n</template>\n<script>\nimport { NavBar, Toast, ImagePreview } from 'vant';\nimport { rechargeBlockchainDetails } from \"@/API/user\";\nimport { getImgUrl, priceFormat } from '@/utils/utis'\nimport QRCode from 'qrcode'\nexport default {\n    name: 'rechargeRecordDetails',\n    components: {\n        [NavBar.name]: NavBar,\n        [Toast.name]: Toast,\n        [ImagePreview.Component.name]: ImagePreview.Component\n    },\n    data() {\n        return {\n            itemName: process.env.VUE_APP_ITEM_NAME,\n            pageDone: false,\n            orderNo: null,\n            dataInfo: null,\n            previewShow: false,\n            previewImages: [],\n            codeImgUrl: '',\n            priceFormat,\n        }\n    },\n    mounted() {\n        this.$nextTick(() => {\n            const { order_no, failure_msg } = this.$route.query\n            if (order_no) {\n                this.orderNo = order_no\n                this.failureMsg = failure_msg\n                this.getDataInfo()\n            } else {\n                Toast(this.$t('订单号不存在'));\n            }\n        })\n    },\n    methods: {\n        onClickLeft() {\n            this.$router.go(-1)\n        },\n        copyData(ea) {\n            this.$copyText(ea).then(() => {\n                Toast(this.$t('复制成功'))\n            }, () => {\n                Toast(this.$t('复制失败'))\n            })\n        },\n        getDataInfo() {\n            Toast.loading({\n                duration: 0,\n                message: this.$t('请求中')\n            })\n            rechargeBlockchainDetails({ order_no: this.orderNo }).then(res => {\n                res.stateStr = ''\n                res.className = ''\n                if (res.state === 0) {\n                    res.stateStr = this.$t('处理中')\n                }\n                if (res.state === 1) {\n                    res.className = 'success'\n                    res.stateStr = this.$t('成功')\n                }\n                if (res.state === 2) {\n                    res.className = 'fail'\n                    res.stateStr = this.$t('失败')\n                }\n                if (res.img) {\n                    this.previewImages = [res.img]\n                }\n                this.dataInfo = res\n                this.pageDone = true\n                Toast.clear()\n                this.$nextTick(() => {\n                    this.createCodeImg(res.from)\n                })\n            }).catch(err => {\n                // Toast(err.msg)\n                Toast.clear()\n            })\n        },\n        // 生成二维码\n        createCodeImg(txt) {\n            const that = this\n            const canvas = document.getElementById('canvas')\n            QRCode.toCanvas(canvas, txt,\n                {\n                    width: 124,\n                    height: 124,\n                    margin: 0\n                }, function (error) {\n                    if (error) {\n                        // console.error(error)\n                    } else {\n                        that.codeImgUrl = canvas.toDataURL('image/png')\n                    }\n                })\n        },\n        saveCodeImg() {\n            let myCanvas = document.getElementsByTagName('canvas');\n            this.imgUrl = myCanvas[0].toDataURL('image/png')\n            this.getUrlBase64(this.imgUrl).then(base64 => {\n                let link = document.createElement('a')\n                link.href = base64\n                link.download = 'qrCode.png'\n                link.click()\n            })\n        },\n        getUrlBase64(url) {\n            return new Promise(resolve => {\n                let canvas = document.createElement('canvas')\n                let ctx = canvas.getContext('2d')\n                let img = new Image()\n                img.crossOrigin = 'Anonymous' //允许跨域\n                img.src = url\n                img.onload = function () {\n                    canvas.height = 300\n                    canvas.width = 300\n                    ctx.drawImage(img, 0, 0, 300, 300)\n                    let dataURL = canvas.toDataURL('image/png')\n                    canvas = null\n                    resolve(dataURL)\n                }\n            })\n        },\n        getImgUrlHandle(path) {\n            console.log(`path ::->`, path);\n            return getImgUrl(path)\n        },\n        toPay(path) {\n            window.open(path)\n        }\n    }\n}\n</script>\n<style lang=\"scss\" scoped>\n.pay_btn {\n    margin-top: 40px;\n    background: var(--main-color);\n}\n\n.page-content {\n    width: 100%;\n    min-height: 100%;\n    background: #F5F5F7;\n\n    * {\n        box-sizing: border-box;\n    }\n\n    .info-content {\n        padding: 10px 15px;\n\n        .order-info-content {\n            padding: 0 10px;\n            background-color: #fff;\n\n            >.item {\n                padding: 17px 0;\n                border-bottom: 1px solid #eee;\n                color: #000;\n                font-size: 14px;\n                display: flex;\n                justify-content: space-between;\n\n                &.center {\n                    align-items: center;\n                }\n\n                >div {\n                    flex: 1;\n                    padding-left: 50px;\n                    text-align: end;\n\n                    &.copy {\n                        display: flex;\n                        justify-content: flex-end;\n\n                        >span {\n                            text-align: start;\n                            flex: 1;\n                            word-break: break-word;\n                        }\n\n                        >img {\n                            width: 10px;\n                            height: 10px;\n                            margin-left: 4px;\n                            position: relative;\n                            top: 3px;\n                        }\n                    }\n\n                    &.money {\n\n                        color: var(--main-color);\n                    }\n\n                    &.success {\n                        color: #0ECB81 !important;\n                    }\n\n                    &.fail {\n                        color: #FF4141 !important;\n                    }\n\n                    .img-content {\n                        width: 62px;\n                        height: 56px;\n                        border-radius: 4px;\n                        background-color: #D9D9D9;\n                        overflow: hidden;\n                        display: flex;\n                        align-content: center;\n                        align-items: center;\n\n                        >img {\n                            width: 100%;\n                            height: auto;\n                        }\n                    }\n                }\n\n                &.code-img {\n                    flex-direction: column;\n                    align-items: center;\n\n                    >div {\n                        padding: 0;\n                        flex: 0;\n                        text-align: center;\n\n                        &.code-img-content {\n                            width: 138px;\n                            height: 138px;\n                            border: 1px solid #ddd;\n                            padding: 6px;\n                            display: flex;\n                            align-items: center;\n                            justify-content: center;\n\n                            >.canvas {\n                                width: 124px;\n                                height: 124px;\n                            }\n                        }\n\n                        &.btn {\n                            margin-top: 10px;\n\n                            >div {\n                                width: 105px;\n                                height: 36px;\n                                line-height: 34px;\n                                border: 1px solid #DDDDDD;\n                                border-radius: 4px;\n                                font-size: 12px;\n                            }\n                        }\n                    }\n                }\n\n                &.no-border,\n                &:last-child {\n                    border-bottom: none;\n                }\n            }\n        }\n    }\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}