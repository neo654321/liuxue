{"ast":null,"code":"import \"vant/es/image-preview/style\";\nimport _ImagePreview from \"vant/es/image-preview\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/nav-bar/style\";\nimport _NavBar from \"vant/es/nav-bar\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport { rechargeBlockchainDetails } from \"@/API/user\";\nimport { getImgUrl, priceFormat } from '@/utils/utis';\nimport QRCode from 'qrcode';\nexport default {\n  name: 'rechargeRecordDetails',\n  components: {\n    [_NavBar.name]: _NavBar,\n    [_Toast.name]: _Toast,\n    [_ImagePreview.Component.name]: _ImagePreview.Component\n  },\n  data() {\n    return {\n      itemName: process.env.VUE_APP_ITEM_NAME,\n      pageDone: false,\n      orderNo: null,\n      dataInfo: null,\n      previewShow: false,\n      previewImages: [],\n      codeImgUrl: '',\n      priceFormat\n    };\n  },\n  mounted() {\n    var _this = this;\n    this.$nextTick(function () {\n      var _this$$route$query = _this.$route.query,\n        order_no = _this$$route$query.order_no,\n        failure_msg = _this$$route$query.failure_msg;\n      if (order_no) {\n        _this.orderNo = order_no;\n        _this.failureMsg = failure_msg;\n        _this.getDataInfo();\n      } else {\n        _Toast(_this.$t('订单号不存在'));\n      }\n    });\n  },\n  methods: {\n    onClickLeft() {\n      this.$router.go(-1);\n    },\n    copyData(ea) {\n      var _this2 = this;\n      this.$copyText(ea).then(function () {\n        _Toast(_this2.$t('复制成功'));\n      }, function () {\n        _Toast(_this2.$t('复制失败'));\n      });\n    },\n    getDataInfo() {\n      var _this3 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('请求中')\n      });\n      rechargeBlockchainDetails({\n        order_no: this.orderNo\n      }).then(function (res) {\n        res.stateStr = '';\n        res.className = '';\n        if (res.state === 0) {\n          res.stateStr = _this3.$t('处理中');\n        }\n        if (res.state === 1) {\n          res.className = 'success';\n          res.stateStr = _this3.$t('成功');\n        }\n        if (res.state === 2) {\n          res.className = 'fail';\n          res.stateStr = _this3.$t('失败');\n        }\n        if (res.img) {\n          _this3.previewImages = [res.img];\n        }\n        _this3.dataInfo = res;\n        _this3.pageDone = true;\n        _Toast.clear();\n        _this3.$nextTick(function () {\n          _this3.createCodeImg(res.from);\n        });\n      }).catch(function (err) {\n        // Toast(err.msg)\n        _Toast.clear();\n      });\n    },\n    // 生成二维码\n    createCodeImg(txt) {\n      var that = this;\n      var canvas = document.getElementById('canvas');\n      QRCode.toCanvas(canvas, txt, {\n        width: 124,\n        height: 124,\n        margin: 0\n      }, function (error) {\n        if (error) {\n          // console.error(error)\n        } else {\n          that.codeImgUrl = canvas.toDataURL('image/png');\n        }\n      });\n    },\n    saveCodeImg() {\n      var myCanvas = document.getElementsByTagName('canvas');\n      this.imgUrl = myCanvas[0].toDataURL('image/png');\n      this.getUrlBase64(this.imgUrl).then(function (base64) {\n        var link = document.createElement('a');\n        link.href = base64;\n        link.download = 'qrCode.png';\n        link.click();\n      });\n    },\n    getUrlBase64(url) {\n      return new Promise(function (resolve) {\n        var canvas = document.createElement('canvas');\n        var ctx = canvas.getContext('2d');\n        var img = new Image();\n        img.crossOrigin = 'Anonymous'; //允许跨域\n        img.src = url;\n        img.onload = function () {\n          canvas.height = 300;\n          canvas.width = 300;\n          ctx.drawImage(img, 0, 0, 300, 300);\n          var dataURL = canvas.toDataURL('image/png');\n          canvas = null;\n          resolve(dataURL);\n        };\n      });\n    },\n    getImgUrlHandle(path) {\n      console.log(\"path ::->\", path);\n      return getImgUrl(path);\n    },\n    toPay(path) {\n      window.open(path);\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}