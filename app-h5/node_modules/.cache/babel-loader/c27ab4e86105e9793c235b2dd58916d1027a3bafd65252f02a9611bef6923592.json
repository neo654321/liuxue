{"ast":null,"code":"import _objectSpread from \"/Users/neo/Desktop/node/liuxue/app-h5/node_modules/.pnpm/@babel+runtime@7.20.7/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/popup/style\";\nimport _Popup from \"vant/es/popup\";\nimport \"vant/es/cell-group/style\";\nimport _CellGroup from \"vant/es/cell-group\";\nimport \"vant/es/cell/style\";\nimport _Cell from \"vant/es/cell\";\nimport \"vant/es/stepper/style\";\nimport _Stepper from \"vant/es/stepper\";\nimport \"vant/es/checkbox-group/style\";\nimport _CheckboxGroup from \"vant/es/checkbox-group\";\nimport \"vant/es/checkbox/style\";\nimport _Checkbox from \"vant/es/checkbox\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\nimport \"vant/es/list/style\";\nimport _List from \"vant/es/list\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { dizhi_liebiao_post } from \"@/API/user\";\nimport { orderSubmit } from \"@/API/commodity\";\nimport { ref } from \"vue\";\nimport { priceFormat } from '@/utils/utis';\n// import EnterPassword from \"@/components/EnterPassword/index.vue\";\nimport Big from 'big.js';\nimport { mapGetters } from \"vuex\";\nexport default {\n  setup() {\n    var checked = ref([\"a\", \"b\"]);\n    var checkedAll = ref(false);\n    var checkboxGroup = ref(null);\n    var checkAll = function checkAll() {\n      checkboxGroup.value.toggleAll(true);\n    };\n    return {\n      checked,\n      checkedAll,\n      checkAll,\n      checkboxGroup\n    };\n  },\n  data() {\n    return {\n      priceFormat,\n      type: 2,\n      //1直接购买,2购物车购买\n      goodsInfo: {},\n      //单个商品信息\n      bugNum: 1,\n      //单个商品选中的数量\n      refreshing: false,\n      paymentChecked: [],\n      checkboxList: [{\n        key: 0,\n        title: \"Blance\",\n        icon: \"\",\n        open: true\n      }, {\n        key: 1,\n        title: \"PayPal\",\n        icon: \"\",\n        open: false\n      }, {\n        key: 2,\n        title: \"Visa\",\n        icon: \"\",\n        open: false\n      }, {\n        key: 3,\n        title: \"Masercard\",\n        icon: \"\",\n        open: false\n      }],\n      list: [],\n      addressList: [],\n      addressInfo: {},\n      orderList: [],\n      total: {},\n      //金额计算数据\n      skuId: \"\",\n      attributes: [],\n      currentCoverImg: '',\n      maxBuyNum: localStorage.getItem('maxBuyNum') || 500\n    };\n  },\n  components: {\n    [_List.name]: _List,\n    [_PullRefresh.name]: _PullRefresh,\n    [_Checkbox.name]: _Checkbox,\n    [_CheckboxGroup.name]: _CheckboxGroup,\n    [_Stepper.name]: _Stepper,\n    [_Cell.name]: _Cell,\n    [_CellGroup.name]: _CellGroup,\n    [_Popup.name]: _Popup,\n    [_Icon.name]: _Icon,\n    [_Toast.name]: _Toast\n  },\n  computed: _objectSpread({}, mapGetters({\n    userInfo: \"userInfo\"\n  })),\n  created() {\n    //获取路由参数\n    try {\n      var _this$$route$query = this.$route.query,\n        type = _this$$route$query.type,\n        goodsInfo = _this$$route$query.goodsInfo,\n        bugNum = _this$$route$query.bugNum,\n        currentCoverImg = _this$$route$query.currentCoverImg;\n      this.currentCoverImg = currentCoverImg;\n      this.type = type;\n      this.goodsInfo = JSON.parse(goodsInfo);\n      this.bugNum = bugNum;\n    } catch (e) {\n      console.log(e);\n    }\n    this.dizhiliebiao();\n    //跳转商品展示\n    this.getProduct();\n    this.init();\n  },\n  methods: {\n    init() {\n      //全选\n      if (this.list.length > 0) {\n        this.list.forEach(function (item) {\n          item.checkedAll = true;\n          if (item.child.length > 0) {\n            item.checkedValue = item.child.map(function (child) {\n              return child === null || child === void 0 ? void 0 : child.tempId;\n            });\n          }\n        });\n      }\n      //计算总金额\n      this.mathMoney();\n    },\n    mathMoney() {\n      var _this = this;\n      this.total = {\n        money: 0,\n        piece: 0,\n        discount: 0,\n        freight: 0,\n        goodsTax: 0,\n        mathMoney: 0,\n        discountPrice: 0\n      };\n      var count = 0;\n      this.list.forEach(function (item) {\n        count += item.checkedValue.length;\n        // this.total.piece = item.checkedValue.length\n        item.child.length > 0 && item.child.forEach(function (child) {\n          //num<item.moreNum&&\n          if (item.checkedValue.includes(child.tempId)) {\n            _this.total.money = _this.$plus(_this.total.money, _this.$operation(child.price, child.count, 'times'));\n            _this.total.freight = _this.$plus(_this.total.freight, _this.$operation(child.freightAmount, child.count, 'times'));\n            _this.total.goodsTax = _this.$plus(_this.total.goodsTax, _this.$operation(child.goodsTax, child.count, 'times'));\n          }\n        });\n      });\n      this.total.piece = count;\n      this.total.mathMoney = new Big(this.total.money).plus(this.total.freight).plus(this.total.goodsTax).minus(this.total.discount);\n      this.total.mathMoney = priceFormat(this.total.mathMoney);\n    },\n    getProduct() {\n      var _this2 = this;\n      if (this.type == 1) {\n        if (this.$route.query.skuId !== \"-1\") {\n          this.skuId = this.$route.query.skuId || 0;\n          this.attributes = this.goodsInfo.canSelectAttributes.skus.filter(function (i) {\n            return i.skuId == _this2.skuId;\n          })[0];\n        }\n\n        // console.log(\"attributes ->\", attributes);\n        var item = {\n          key: 0,\n          sort: this.goodsInfo.storeName,\n          checkedAll: false,\n          checkedValue: [],\n          moreNum: 2,\n          child: [{\n            key: 1,\n            img: this.goodsInfo.imgUrl1 || this.$defaultGoodsImage,\n            price: this.goodsInfo.discountPrice ? this.goodsInfo.discountPrice : this.goodsInfo.sellingPrice,\n            describe: this.goodsInfo.name,\n            attributes: this.attributes || [],\n            count: this.bugNum,\n            id: this.goodsInfo.id,\n            freightAmount: this.goodsInfo.freightAmount,\n            goodsTax: this.goodsInfo.goodsTax\n          }]\n        };\n        this.list.push(item);\n      } else {\n        //   console.log(\"this.goodsInfo ->\", this.list);\n        this.list = this.$ls.get(\"cartList\");\n      }\n    },\n    // 单选\n    handlecheckItemClick(item, index, n) {\n      var _this3 = this;\n      if (this.list[index].child[n].selected == undefined) this.list[index].child[n].selected = true;\n      this.list[index].child[n].selected = !this.list[index].child[n].selected;\n      var count = 0;\n      var num = 0;\n      var len = this.list[index].child.length;\n      this.list[index].child.forEach(function (sub) {\n        if (sub.selected) count += 1;else num += 1;\n        if (num == len) _this3.list[index].checkedAll = false;\n        if (count != 0) _this3.list[index].checkedAll = true;\n      });\n    },\n    //类全选\n    handleCheckItemAll(value, index) {\n      var _this4 = this;\n      this.list[index].checkedValue = [];\n      this.$nextTick(function () {\n        _this4.list[index].child.forEach(function (item, num) {\n          item.selected = value;\n          value && _this4.list[index].checkedValue.push(item.tempId);\n        });\n      });\n      // this.list[index].checkedValue = [];\n      // if (value) {\n      //   this.list[index].child.forEach((item, num) => {\n      //     if (num < this.list[index].moreNum) {\n      //       this.list[index].checkedValue.push(item.id);\n      //     }\n      //   });\n      // }\n      this.mathMoney();\n    },\n    onRefresh() {\n      // 清空列表数据\n      this.finished = false;\n      this.loading = true;\n      this.onLoad();\n    },\n    onLoad() {\n      if (this.refreshing) {\n        this.refreshing = false;\n      }\n    },\n    onClickLeft() {\n      this.$router.go(-1);\n      // this.$router.push({ path: \"/cart\" });\n    },\n\n    // 确认\n    handleConfri() {\n      var _this5 = this;\n      if (this.userInfo.roletype === 1) {\n        _Toast(this.$t(\"allowBuy\"));\n        return;\n      }\n      if (!(this.total.piece > 0)) {\n        _Toast(this.$t(\"请选择要购买的商品\"));\n        return;\n      }\n      var dataJson = {\n        orderInfo: \"\",\n        addressId: this.addressInfo.id\n      };\n      if (this.type == 1) {\n        dataJson.orderInfo = \"\".concat(this.goodsInfo.id, \",\").concat(this.$route.query.skuId || \"-1\", \",\").concat(this.list[0].child[0].count);\n      } else {\n        this.list.forEach(function (item) {\n          item.child.length > 0 && item.child.forEach(function (child) {\n            if (item.checkedValue.includes(child.tempId)) {\n              dataJson.orderInfo += \"\".concat(child.id, \",\").concat((child === null || child === void 0 ? void 0 : child.skuId) || \"-1\", \",\").concat(child.count, \",\");\n            }\n          });\n        });\n      }\n      orderSubmit(dataJson).then(function (res) {\n        var _this5$$route$query;\n        _this5.orderList = res.orderList;\n        var productList = _this5.$ls.get(\"productList\") || [];\n        var ids = [];\n        productList === null || productList === void 0 || productList.forEach(function (item) {\n          _this5.list.forEach(function (_ref) {\n            var child = _ref.child;\n            child.forEach(function (_ref2) {\n              var id = _ref2.id,\n                selected = _ref2.selected;\n              if (id == item.id && selected) ids.push(id);\n            });\n          });\n        });\n        _this5.$router.push({\n          path: \"/PendingPayment\",\n          query: {\n            orderList: JSON.stringify(_this5.orderList),\n            total: _this5.total.mathMoney,\n            ids,\n            isCart: ((_this5$$route$query = _this5.$route.query) === null || _this5$$route$query === void 0 ? void 0 : _this5$$route$query.isCart) || 0\n          }\n        });\n        // this.pwtStatus=true\n      });\n    },\n\n    //获取地址列表\n    dizhiliebiao() {\n      var _this6 = this;\n      dizhi_liebiao_post({}).then(function (res) {\n        var _res$pageList;\n        if (!((_res$pageList = res.pageList) !== null && _res$pageList !== void 0 && (_res$pageList = _res$pageList[0]) !== null && _res$pageList !== void 0 && _res$pageList.country)) return;\n        _this6.addressList = res.pageList;\n        var address = JSON.parse(_this6.$ls.get(\"address\"));\n        if (address) {\n          _this6.addressInfo = address;\n          _this6.$ls.remove(\"address\");\n          return;\n        }\n        _this6.addressList.map(function (item) {\n          item.phone = item.phone.indexOf(\"|\") > -1 ? item.phone.split(\"|\")[1] : item.phone;\n          if (item.use === 1) {\n            _this6.addressInfo = item;\n          }\n        });\n      }).catch(function () {});\n    },\n    openAddress() {\n      this.$router.push(\"/AddressList?c=1\");\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACAA;IACA;IACA;IACA;IACA;MACAC;IACA;IACA;MACAC;MACAC;MACAC;MACAH;IACA;EACA;EACAI;IACA;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACAC,eACA;QAAAC;QAAAC;QAAAC;QAAAC;MAAA,GACA;QAAAH;QAAAC;QAAAC;QAAAC;MAAA,GACA;QAAAH;QAAAC;QAAAC;QAAAC;MAAA,GACA;QAAAH;QAAAC;QAAAC;QAAAC;MAAA,EACA;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;EACA;EAEAC,4BACAC;IACAC;EACA,GACA;EACAC;IACA;IACA;MACA;QAAAvB;QAAAC;QAAAC;QAAAe;MACA;MACA;MACA;MACA;IACA;MACAO;IACA;IAEA;IACA;IACA;IAEA;EACA;EACAC;IACAC;MACA;MACA;QACA;UACAC;UACA;YACAA;cAAA;YAAA;UACA;QACA;MACA;MACA;MACA;IACA;IACAC;MAAA;MACA;QACAC;QACAC;QACAC;QACAC;QACAC;QACAL;QACAM;MACA;MACA;MACA;QACAC;QACA;QACAR,yBACAA;UACA;UACA;YACA;YACA;YACA;UACA;QACA;MACA;MACA;MACA;MACA;IACA;IACAS;MAAA;MACA;QACA;UACA;UACA,iEACA;YAAA;UAAA,EACA;QACA;;QAEA;QACA;UACA9B;UACA+B;UACAzC;UACA0C;UACAC;UACAC,QACA;YACAlC;YACAmC;YACAC,sCACA,+BACA;YACAC;YACA3B;YACAmB;YACAS;YAEAC;YACAZ;UACA;QAEA;QACA;MACA;QACA;QACA;MACA;IACA;IACA;IACAa;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;QACA,kCACAC;QACA;QACA;MACA;IAEA;IACA;IACAC;MAAA;MACA;MACA;QACA;UACArB;UACAsB;QACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;QACA;MACA;IACA;IACAC;MACA;MACA;IACA;;IACA;IACAC;MAAA;MAEA;QACA;QAEA;MACA;MAIA;QACA;QACA;MACA;MACA;QACAC;QACAC;MACA;MACA;QACAC,2GACA;MACA;QACA;UACA7B,yBACAA;YACA;cACA6B,wJACA;YACA;UACA;QACA;MACA;MACAC;QAAA;QACA;QACA;QACA;QACAC;UACA;YAAA;YACAlB;cAAA;gBAAAmB;cACA;YACA;UACA;QACA;QACA;UACAC;UACAC;YACAhD;YACAC;YACAgD;YACAC;UACA;QACA;QACA;MACA;IACA;;IACA;IACAC;MAAA;MACAC,uBACAC;QAAA;QACA;QACA;QACA;QACA;UACA;UACA;UACA;QACA;QACA;UACAvC,aACAA,+BACAA,2BACAA;UACA;YACA;UACA;QACA;MACA,GACAwC;IACA;IACAC;MACA;IACA;EACA;AAEA","names":["setup","checkboxGroup","checked","checkedAll","checkAll","data","priceFormat","type","goodsInfo","bugNum","refreshing","paymentChecked","checkboxList","key","title","icon","open","list","addressList","addressInfo","orderList","total","skuId","attributes","currentCoverImg","maxBuyNum","components","computed","mapGetters","userInfo","created","console","methods","init","item","mathMoney","money","piece","discount","freight","goodsTax","discountPrice","count","getProduct","sort","checkedValue","moreNum","child","img","price","describe","id","freightAmount","handlecheckItemClick","num","handleCheckItemAll","value","onRefresh","onLoad","onClickLeft","handleConfri","orderInfo","addressId","dataJson","orderSubmit","productList","selected","path","query","ids","isCart","dizhiliebiao","dizhi_liebiao_post","then","catch","openAddress"],"sourceRoot":"src/page/orderComnfirmation","sources":["index.vue"],"sourcesContent":["<template>\n    <div class=\"mall\">\n        <van-nav-bar safe-area-inset-top fixed class=\"nav-bar\" left-arrow @click-left=\"onClickLeft\" :title=\"$t('订单确认')\" />\n        <div style=\"width: 100%; height: 46px\"></div>\n        <div class=\"address-wrap\" v-if=\"addressList.length == 0\" @click=\"openAddress\">\n            <div class=\"left\">\n                <img src=\"../../assets/image/me/dizhi.png\" />\n                {{ $t(\"您还没有添加送货地址\") }}\n            </div>\n            <div class=\"right\">\n                <van-icon name=\"arrow\" class=\"arrow-right\" />\n            </div>\n        </div>\n        <div class=\"address-wrap-disabled\" v-else @click=\"openAddress\">\n            <div class=\"left\">\n                <div class=\"address-title\">\n                    <img src=\"../../assets/image/me/dizhi1.png\" />\n                    <span>{{ addressInfo.contacts }} {{ addressInfo.phone }}</span>\n                </div>\n                <div class=\"address-details\">\n                    {{ addressInfo.address }}\n                </div>\n            </div>\n            <div class=\"right\" >\n                <van-icon name=\"arrow\" class=\"arrow-right\" />\n            </div>\n        </div>\n        <van-pull-refresh v-model=\"refreshing\" @refresh=\"onRefresh\" :pulling-text=\"$t('下拉即可刷新')\"\n            :loosing-text=\"$t('释放即可刷新')\" :loading-text=\"$t('加载中')\">\n            <template>\n                <div v-for=\"(item, index) in list\" :key=\"item.key\" class=\"mall-detail\">\n                    <van-checkbox class=\"mall-title\" v-model=\"item.checkedAll\"\n                        @change=\"handleCheckItemAll(item.checkedAll, index)\">{{ item.sort }}</van-checkbox>\n                    <div class=\"mall-item\">\n                        <van-checkbox-group v-model=\"item.checkedValue\" @change=\"mathMoney\">\n                            <template v-for=\"(i, n) in item.child\">\n                                <van-checkbox class=\"mall-item-checkbox\" :name=\"i.tempId\" :key=\"i.key\"\n                                    v-if=\"n < item.moreNum\" @click=\"handlecheckItemClick(item, index, n)\">\n                                    <div class=\"mall-item-child\">\n                                        <div class=\"mall-item-child-img\">\n                                            <img :src=\"currentCoverImg || i.img\" class=\"img\" />\n                                        </div>\n                                        <div style=\"width: 75%; margin-left: 6px\">\n                                            <p class=\"describe\">\n                                                {{\n                                                    i.describe?.length > 42\n                                                    ? i.describe.slice(0, 42) + \"...\"\n                                                    : i.describe\n                                                }}\n                                            </p>\n                                            <p v-if=\"i.attributes\" class=\"sku_box\">\n                                                <span class=\"attribute\" v-for=\"(j, p) in i.attributes.attrs\" :key=\"p\"\n                                                    v-if=\"j.attrName && j.attrValueName\">\n                                                    {{ j.attrName }}:{{ j.attrValueName }}</span>\n                                            </p>\n                                            <div class=\"price\">\n\n                                                <span>${{ priceFormat(i.price) }}</span>\n                                                <div class=\"stepper\" @click.stop=\"mathMoney\">\n                                                    <van-stepper :disable-input=\"true\" :max=\"maxBuyNum\" integer\n                                                        v-model=\"i.count\" @change=\"mathMoney\" />\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </van-checkbox>\n                            </template>\n\n                            <div class=\"show-more\" v-show=\"\n                                item.child.length > 1 && item.moreNum < item.child.length\n                            \" @click=\"item.moreNum += 2\">\n                                <p>{{ $t(\"查看更多\") }}</p>\n                                <img src=\"../../assets/image/index/down-icon.png\" />\n                            </div>\n                        </van-checkbox-group>\n                    </div>\n                </div>\n                <van-cell-group inset>\n                    <van-cell :title=\"$t('物品金额')\" :value=\"'$' + priceFormat(total.money)\" />\n                    <!-- <van-cell :title=\"$t('折扣')\" :value=\"'-$'+total.discount\" class='font-color'/> -->\n                    <van-cell :title=\"$t('运送费')\" :value=\"'+$' + (total.freight > 0 ? priceFormat(total.freight) : '0.00')\"\n                        class=\"font-color\" />\n                    <van-cell :title=\"$t('税费')\" :value=\"'+$' + (total.freight > 0 ? priceFormat(total.freight) : '0.00')\"\n                        class=\"font-color\" />\n                    <van-cell :title=\"$t('总计')\" :value=\"'$' + (total.mathMoney > 0 ? priceFormat(total.mathMoney) : '0.00')\"\n                        class=\"font-color\" />\n                </van-cell-group>\n                <!-- 付款方式 -->\n                <div class=\"payment-cell\" v-show=\"false\">\n                    <van-checkbox-group v-model=\"paymentChecked\" style=\"margin: 10px 0\">\n                        <van-cell-group inset>\n                            <van-cell clickable title=\"Blance\" icon=\"shop-o\">\n                                <span class=\"yellow-color\">($666.12)</span>\n                                <template #right-icon>\n                                    <van-checkbox name=\"Blance\" @click.stop />\n                                </template>\n                            </van-cell>\n                            <van-cell clickable title=\"PayPal\" icon=\"shop-o\">\n                                <span>({{ $t(\"尚未开放\") }})</span>\n                                <template #right-icon>\n                                    <van-checkbox name=\"PayPal\" @click.stop disabled />\n                                </template>\n                            </van-cell>\n                            <van-cell clickable title=\"Visa\" icon=\"shop-o\">\n                                <span>({{ $t(\"尚未开放\") }})</span>\n                                <template #right-icon>\n                                    <van-checkbox name=\"Visa\" @click.stop disabled />\n                                </template>\n                            </van-cell>\n                            <van-cell clickable title=\"Masercard\" icon=\"shop-o\">\n                                <span>(Additional <span class=\"yellow-color\">$23</span> handing fee\n                                    is required)</span>\n                                <template #right-icon>\n                                    <van-checkbox name=\"Masercard\" @click.stop />\n                                </template>\n                            </van-cell>\n                        </van-cell-group>\n                    </van-checkbox-group>\n                </div>\n            </template>\n        </van-pull-refresh>\n        <div class=\"mall-bottom\">\n            <span>{{ $t(\"总计\") }}\n                <span class=\"price\">${{ total.mathMoney }}</span></span>\n            <span>{{ $t(\"选择\") }} <span class=\"piece\">{{ total.piece }}</span>\n                {{ $t(\"个\") }}</span>\n            <van-button class=\"button\" color=\"rgba(233, 157, 56, 1)\" @click=\"handleConfri\">{{ $t(\"确认\") }}</van-button>\n        </div>\n        <div style=\"width: 100%; height: 60px\"></div>\n    </div>\n</template>\n<script>\nimport {\n    // NavBar,\n    // Tab,\n    // Tabs,\n    PullRefresh,\n    List,\n    Checkbox,\n    CheckboxGroup,\n    Stepper,\n    CellGroup,\n    Cell,\n    Popup,\n    Icon,\n    Toast,\n} from \"vant\";\nimport { dizhi_liebiao_post } from \"@/API/user\";\nimport { orderSubmit } from \"@/API/commodity\";\nimport { ref } from \"vue\";\nimport { priceFormat } from '@/utils/utis'\n// import EnterPassword from \"@/components/EnterPassword/index.vue\";\nimport Big from 'big.js'\nimport {mapGetters} from \"vuex\";\nexport default {\n    setup() {\n        const checked = ref([\"a\", \"b\"]);\n        const checkedAll = ref(false);\n        const checkboxGroup = ref(null);\n        const checkAll = () => {\n            checkboxGroup.value.toggleAll(true);\n        };\n        return {\n            checked,\n            checkedAll,\n            checkAll,\n            checkboxGroup,\n        };\n    },\n    data() {\n        return {\n            priceFormat,\n            type: 2, //1直接购买,2购物车购买\n            goodsInfo: {}, //单个商品信息\n            bugNum: 1, //单个商品选中的数量\n            refreshing: false,\n            paymentChecked: [],\n            checkboxList: [\n                { key: 0, title: \"Blance\", icon: \"\", open: true },\n                { key: 1, title: \"PayPal\", icon: \"\", open: false },\n                { key: 2, title: \"Visa\", icon: \"\", open: false },\n                { key: 3, title: \"Masercard\", icon: \"\", open: false },\n            ],\n            list: [],\n            addressList: [],\n            addressInfo: {},\n            orderList: [],\n            total: {}, //金额计算数据\n            skuId: \"\",\n            attributes: [],\n            currentCoverImg: '',\n            maxBuyNum: localStorage.getItem('maxBuyNum') || 500,\n        };\n    },\n    components: {\n        [List.name]: List,\n        [PullRefresh.name]: PullRefresh,\n        [Checkbox.name]: Checkbox,\n        [CheckboxGroup.name]: CheckboxGroup,\n        [Stepper.name]: Stepper,\n        [Cell.name]: Cell,\n        [CellGroup.name]: CellGroup,\n        [Popup.name]: Popup,\n        [Icon.name]: Icon,\n        [Toast.name]: Toast,\n    },\n\n  computed: {\n    ...mapGetters({\n      userInfo: \"userInfo\",\n    }),\n  },\n    created() {\n        //获取路由参数\n        try {\n            let { type, goodsInfo, bugNum, currentCoverImg } = this.$route.query;\n            this.currentCoverImg = currentCoverImg;\n            this.type = type;\n            this.goodsInfo = JSON.parse(goodsInfo);\n            this.bugNum = bugNum;\n        } catch (e) {\n            console.log(e);\n        }\n\n        this.dizhiliebiao();\n        //跳转商品展示\n        this.getProduct();\n\n        this.init();\n    },\n    methods: {\n        init() {\n            //全选\n            if (this.list.length > 0) {\n                this.list.forEach((item) => {\n                    item.checkedAll = true;\n                    if (item.child.length > 0) {\n                        item.checkedValue = item.child.map(child => child?.tempId);\n                    }\n                });\n            }\n            //计算总金额\n            this.mathMoney();\n        },\n        mathMoney() {\n            this.total = {\n                money: 0,\n                piece: 0,\n                discount: 0,\n                freight: 0,\n                goodsTax: 0,\n                mathMoney: 0,\n                discountPrice: 0,\n            };\n            let count = 0\n            this.list.forEach((item) => {\n                count += item.checkedValue.length\n                // this.total.piece = item.checkedValue.length\n                item.child.length > 0 &&\n                    item.child.forEach((child) => {\n                        //num<item.moreNum&&\n                        if (item.checkedValue.includes(child.tempId)) {\n                            this.total.money = this.$plus(this.total.money, this.$operation(child.price, child.count, 'times'));\n                            this.total.freight = this.$plus(this.total.freight, this.$operation(child.freightAmount, child.count, 'times'))\n                            this.total.goodsTax = this.$plus(this.total.goodsTax, this.$operation(child.goodsTax, child.count, 'times'))\n                        }\n                    });\n            });\n            this.total.piece = count\n            this.total.mathMoney = new Big(this.total.money).plus(this.total.freight).plus(this.total.goodsTax).minus(this.total.discount)\n            this.total.mathMoney = priceFormat(this.total.mathMoney)\n        },\n        getProduct() {\n            if (this.type == 1) {\n                if (this.$route.query.skuId !== \"-1\") {\n                    this.skuId = this.$route.query.skuId || 0;\n                    this.attributes = this.goodsInfo.canSelectAttributes.skus.filter(\n                        (i) => i.skuId == this.skuId\n                    )[0];\n                }\n\n                // console.log(\"attributes ->\", attributes);\n                let item = {\n                    key: 0,\n                    sort: this.goodsInfo.storeName,\n                    checkedAll: false,\n                    checkedValue: [],\n                    moreNum: 2,\n                    child: [\n                        {\n                            key: 1,\n                            img: this.goodsInfo.imgUrl1 || this.$defaultGoodsImage,\n                            price: this.goodsInfo.discountPrice\n                                ? this.goodsInfo.discountPrice\n                                : this.goodsInfo.sellingPrice,\n                            describe: this.goodsInfo.name,\n                            attributes: this.attributes || [],\n                            count: this.bugNum,\n                            id: this.goodsInfo.id,\n\n                            freightAmount: this.goodsInfo.freightAmount,\n                            goodsTax: this.goodsInfo.goodsTax,\n                        },\n                    ],\n                };\n                this.list.push(item);\n            } else {\n                //   console.log(\"this.goodsInfo ->\", this.list);\n                this.list = this.$ls.get(\"cartList\");\n            }\n        },\n        // 单选\n        handlecheckItemClick(item, index, n) {\n            if (this.list[index].child[n].selected == undefined) this.list[index].child[n].selected = true\n            this.list[index].child[n].selected = !this.list[index].child[n].selected;\n            let count = 0;\n            let num = 0;\n            let len = this.list[index].child.length;\n            this.list[index].child.forEach((sub) => {\n                if (sub.selected) count += 1;\n                else num += 1;\n                if (num == len) this.list[index].checkedAll = false;\n                if (count != 0) this.list[index].checkedAll = true;\n            });\n\n        },\n        //类全选\n        handleCheckItemAll(value, index) {\n            this.list[index].checkedValue = [];\n            this.$nextTick(() => {\n                this.list[index].child.forEach((item, num) => {\n                    item.selected = value;\n                    value && this.list[index].checkedValue.push(item.tempId);\n                });\n            });\n            // this.list[index].checkedValue = [];\n            // if (value) {\n            //   this.list[index].child.forEach((item, num) => {\n            //     if (num < this.list[index].moreNum) {\n            //       this.list[index].checkedValue.push(item.id);\n            //     }\n            //   });\n            // }\n            this.mathMoney();\n        },\n        onRefresh() {\n            // 清空列表数据\n            this.finished = false;\n            this.loading = true;\n            this.onLoad();\n        },\n        onLoad() {\n            if (this.refreshing) {\n                this.refreshing = false;\n            }\n        },\n        onClickLeft() {\n            this.$router.go(-1);\n            // this.$router.push({ path: \"/cart\" });\n        },\n        // 确认\n        handleConfri() {\n\n          if (this.userInfo.roletype === 1) {\n            Toast(this.$t(\"allowBuy\"));\n\n            return;\n          }\n\n\n\n          if (!(this.total.piece > 0)) {\n                Toast(this.$t(\"请选择要购买的商品\"));\n                return;\n            }\n            let dataJson = {\n                orderInfo: \"\",\n                addressId: this.addressInfo.id,\n            };\n            if (this.type == 1) {\n                dataJson.orderInfo = `${this.goodsInfo.id},${this.$route.query.skuId || \"-1\"\n                    },${this.list[0].child[0].count}`;\n            } else {\n                this.list.forEach((item) => {\n                    item.child.length > 0 &&\n                        item.child.forEach((child) => {\n                            if (item.checkedValue.includes(child.tempId)) {\n                                dataJson.orderInfo += `${child.id},${child?.skuId || \"-1\"},${child.count\n                                    },`;\n                            }\n                        });\n                });\n            }\n            orderSubmit(dataJson).then((res) => {\n                this.orderList = res.orderList;\n                let productList = this.$ls.get(\"productList\") || [];\n                let ids = [];\n                productList?.forEach((item) => {\n                    this.list.forEach(({ child }) => {\n                        child.forEach(({ id, selected }) => {\n                            if (id == item.id && selected) ids.push(id);\n                        });\n                    });\n                });\n                this.$router.push({\n                    path: \"/PendingPayment\",\n                    query: {\n                        orderList: JSON.stringify(this.orderList),\n                        total: this.total.mathMoney,\n                        ids,\n                        isCart: this.$route.query?.isCart || 0,\n                    },\n                });\n                // this.pwtStatus=true\n            });\n        },\n        //获取地址列表\n        dizhiliebiao() {\n            dizhi_liebiao_post({})\n                .then((res) => {\n                    if (!res.pageList?.[0]?.country) return\n                    this.addressList = res.pageList;\n                    let address = JSON.parse(this.$ls.get(\"address\"));\n                    if (address) {\n                        this.addressInfo = address;\n                        this.$ls.remove(\"address\");\n                        return;\n                    }\n                    this.addressList.map((item) => {\n                        item.phone =\n                            item.phone.indexOf(\"|\") > -1\n                                ? item.phone.split(\"|\")[1]\n                                : item.phone;\n                        if (item.use === 1) {\n                            this.addressInfo = item;\n                        }\n                    });\n                })\n                .catch(() => { });\n        },\n        openAddress() {\n            this.$router.push(\"/AddressList?c=1\");\n        },\n    },\n\n};\n</script>\n<style lang=\"scss\" scoped>\n.attribute {\n    font-size: 12px;\n    color: #333;\n    margin-right: 10px;\n}\n\n.mall {\n    position: relative;\n    background: rgba(238, 238, 238, 1);\n    min-height: 100%;\n    font-size: 14px;\n    box-sizing: border-box;\n    overflow-x: hidden;\n    .mall-detail {\n        margin-bottom: 20px;\n        padding: 0 15px;\n\n        .mall-title {\n            font-size: 14px;\n            margin: 14px 0;\n        }\n\n        .mall-item {\n            // width: 345px;\n            background: #fff;\n            height: auto;\n\n            .mall-item-child {\n                width: 100%;\n                display: flex;\n                justify-content: space-around;\n                align-items: center;\n\n                .mall-item-child-img {\n                    width: 62px;\n                    height: 62px;\n                    display: table-cell;\n\n                    img {\n                        max-width: 100%;\n                        max-height: 100%;\n                        display: block;\n                        margin: auto;\n                    }\n                }\n\n                .price {\n                    color: var(--main-color);\n                    font-size: 16px;\n                    font-weight: 500;\n                    display: flex;\n                    justify-content: space-between;\n                    align-items: center;\n                    margin-top: 10px;\n                }\n\n                .describe {\n                    font-size: 14px;\n                    color: #000;\n                    width: 100%;\n                    // height: 40px;\n                    width: 195px;\n                    display: -webkit-box;\n                    -webkit-box-orient: vertical;\n                    -moz-box-orient: vertical;\n                    box-orient: vertical;\n                    -webkit-line-clamp: 2;\n                    line-clamp: 2;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n\n                .stepper {\n                    width: 100%;\n                    display: flex;\n                    justify-content: flex-end;\n                    align-items: center;\n                    margin-right: 10px;\n                }\n            }\n        }\n\n        .mall-item-checkbox {\n            border-bottom: 1px solid #eee;\n            width: 100%;\n            min-height: 107px;\n            padding-bottom: 10px;\n\n            .sku_box {\n                display: flex;\n                flex-wrap: wrap;\n            }\n        }\n\n        .mall-item-checkbox:nth-last-child(2) {\n            border: none;\n        }\n\n        .show-more {\n            color: #000;\n            font-size: 12px;\n            text-align: center;\n\n            img {\n                width: 16px;\n                height: 16px;\n            }\n        }\n    }\n\n    .mall-empty {\n        height: calc(100vh);\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n\n        .img {\n            width: 100px;\n        }\n\n        .text {\n            font-size: 16px;\n            margin: 20px 0;\n        }\n\n        .button {\n            min-width: 100px;\n            height: 40px;\n        }\n    }\n\n    .mall-bottom {\n        width: 100%;\n        background: #fff;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        font-size: 14px;\n        padding: 8px 7px;\n        position: fixed;\n        bottom: 0;\n        box-sizing: border-box;\n        .checkbox {\n            font-size: 14px;\n            margin: 14px 0;\n        }\n\n        .price {\n            color: var(--main-color);\n            font-size: 16px;\n            font-weight: 600;\n        }\n\n        .piece {\n            color: var(--main-color);\n        }\n\n        .button {\n            min-width: 100px;\n        }\n    }\n}\n\n.address-wrap {\n    height: 45px;\n    margin: 0 15px;\n    background: url(\"../../assets/image/me/bg.png\") no-repeat center center;\n    background-size: cover;\n    display: flex;\n    padding: 0 15px;\n    align-items: center;\n    margin-top: 15px;\n\n    .left {\n        flex: 1;\n        color: #ffffff;\n        display: flex;\n        align-items: center;\n\n        img {\n            height: 22px;\n            margin-right: 10px;\n        }\n    }\n\n    .right {\n        .arrow-right {\n            color: #ffffff;\n            font-size: 16px;\n        }\n    }\n}\n\n.address-wrap-disabled {\n    background: #fff;\n    margin: 0 15px;\n    margin-top: 15px;\n    display: flex;\n    padding: 20px 15px 20px 15px;\n    align-items: center;\n    overflow: hidden;\n    box-sizing: border-box;\n    .left {\n        flex: 1;\n\n        .address-title {\n            display: flex;\n            align-items: center;\n            color: #333333;\n\n            img {\n                height: 22px;\n                margin-right: 10px;\n            }\n        }\n\n        .address-details {\n            color: #999999;\n            width: 240px;\n            word-wrap: break-word;\n            padding-left: 35px;\n            margin-top: 10px;\n        }\n    }\n\n    .right {\n        .arrow-right {\n            font-size: 16px;\n        }\n    }\n}\n\n/deep/ .van-checkbox__icon--checked .van-icon {\n    background-color: var(--main-color) !important;\n    border-color: var(--main-color) !important;\n}\n\n/deep/ .van-checkbox__icon {\n    font-size: 16px !important;\n    padding: 0 11px;\n}\n\n.payment-cell /deep/ .van-cell__value {\n    text-align: start;\n}\n\n.font-color /deep/ .van-cell__value {\n    color: var(--main-color);\n}\n\n.yellow-color {\n    color: var(--main-color);\n}\n\n/deep/ .van-checkbox__label--disabled {\n    color: #333333;\n}\n\n/deep/ .van-checkbox__label {\n    flex-grow: 1;\n    width: 100%;\n}\n\n/deep/ .van-button {\n    margin-right: 14px;\n}\n\n/deep/ .van-stepper {\n    margin-right: 13px;\n}\n\n/deep/ .van-pull-refresh {\n    padding-bottom: 20px;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}