{"ast":null,"code":"import _toConsumableArray from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectSpread from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/empty/style\";\nimport _Empty from \"vant/es/empty\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/list/style\";\nimport _List from \"vant/es/list\";\nimport \"vant/es/search/style\";\nimport _Search from \"vant/es/search\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport GoodsContentOne from \"@/components/GoodsContentOne/index.vue\";\nimport ShopContentTwo from \"@/components/ShopContentTwo/index.vue\";\nimport { mapGetters } from \"vuex\";\nimport debounce from \"lodash.debounce\";\nimport { searchKeyword, searchKeywordGoods, searchSeller, apiSearchSellerGoods } from \"@/API/common\";\nexport default {\n  name: \"Search\",\n  components: {\n    [_PullRefresh.name]: _PullRefresh,\n    [_Search.name]: _Search,\n    [_List.name]: _List,\n    [_Icon.name]: _Icon,\n    [_Empty.name]: _Empty,\n    [_Toast.name]: _Toast,\n    GoodsContentOne,\n    ShopContentTwo\n  },\n  data() {\n    return {\n      searchIcon: require(\"@/assets/image/index/sousuo.png\"),\n      clearIcon: require(\"@/assets/image/index/shanchu.png\"),\n      keyword: \"\",\n      tipsShow: false,\n      tipsData: [],\n      shopData: [],\n      shopShow: false,\n      listData: [],\n      listShow: false,\n      listLoading: false,\n      loading: false,\n      finished: false,\n      refreshing: false,\n      pageNum: 1,\n      pageSize: 20,\n      currentGoodsId: null,\n      searchHistory2: [],\n      isEmpty: false\n    };\n  },\n  computed: _objectSpread({}, mapGetters({\n    searchHistory: \"searchHistory\",\n    activeLang: \"language\"\n  })),\n  beforeRouteLeave(to, from, next) {\n    from.meta.keepAlive = Boolean(to.name === \"CommodityDetails\");\n    next();\n  },\n  mounted() {\n    this.searchHistory2 = JSON.parse(localStorage.getItem(this.$route.query.sellerId)) || [];\n    this.searchHistory2 = _toConsumableArray(new Set(this.searchHistory2));\n    this.tipsData = [];\n  },\n  methods: {\n    onRefresh() {\n      this.finished = false;\n      this.pageNum = 1;\n      this.loading = true;\n      this.onLoad();\n    },\n    onLoad() {\n      if (this.refreshing) {\n        this.list = [];\n        this.refreshing = false;\n      }\n      this.getListData();\n    },\n    getListData() {\n      var _this = this;\n      if (this.currentGoodsId) {\n        searchKeywordGoods({\n          goodsId: this.currentGoodsId,\n          pageNum: this.pageNum,\n          pageSize: this.pageSize\n        }).then(function (res) {\n          var pageList = res.pageList;\n          _this.listData = _this.pageNum === 1 ? pageList : [].concat(_toConsumableArray(_this.listData), _toConsumableArray(pageList));\n          _this.pageNum++;\n          _this.loading = false;\n          if (pageList.length < _this.pageSize) {\n            _this.finished = true;\n          }\n          _this.listLoading = false;\n          _Toast.clear();\n        }).catch(function () {\n          _this.loading = false;\n          _this.listLoading = false;\n          _Toast.clear();\n        });\n      } else {\n        this.listLoading = false;\n        this.finished = true;\n        _Toast.clear();\n        this.listData = [];\n      }\n    },\n    tipsHandle(data, isShop) {\n      var _this2 = this;\n      if (typeof data == \"string\") {\n        this.keyword = data;\n        this.searchHandle();\n        return;\n      }\n      if (isShop) {\n        this.shopShow = true;\n        this.tipsShow = false;\n        this.listShow = false;\n        searchSeller({\n          keyword: this.keyword,\n          isHot: \"0\",\n          isPrice: \"0\",\n          isNew: \"0\"\n        }).then(function (res) {\n          console.log(\"res ->\", res);\n          _this2.shopData = res.sellerList;\n        });\n      } else {\n        this.listShow = true;\n        this.tipsShow = false;\n        this.shopShow = false;\n        this.keyword = data.name;\n        this.currentGoodsId = data.goodsId;\n        this.$store.dispatch(\"setSearchHistory\", {\n          name: data.name,\n          goodsId: data.goodsId\n        });\n        _Toast.loading({\n          duration: 0,\n          message: this.$t(\"加载中\")\n        });\n        this.pageNum = 1;\n        this.finished = false;\n        this.loading = true;\n        this.listLoading = true;\n        this.refreshing = true;\n        this.listData = [];\n        this.onLoad();\n      }\n    },\n    clearHandle() {\n      this.tipsShow = false;\n      this.listShow = false;\n      this.shopShow = false;\n      this.keyword = \"\";\n    },\n    inputHandle: debounce(function () {\n      this.searchHandle();\n    }, 200),\n    searchHandle() {\n      var _this3 = this;\n      var keyword = String(this.keyword).trim();\n      if (keyword == \"\") return _Toast(this.$t(\"请输入搜索内容\"));\n      this.tipsShow = true;\n      this.listShow = false;\n      this.shopShow = false;\n      if (keyword) {\n        this.searchHistory2.push(keyword);\n        this.searchHistory2 = _toConsumableArray(new Set(this.searchHistory2));\n        localStorage.setItem(this.$route.query.sellerId, JSON.stringify(this.searchHistory2));\n        apiSearchSellerGoods({\n          keyword,\n          sellerId: this.$route.query.sellerId\n        }).then(function (res) {\n          // const { goodsList, sellerList } = res\n          var pageList = res.pageList,\n            pageInfo = res.pageInfo;\n          if (!pageList.length) {\n            _Toast(\"\".concat(_this3.$t(\"未找到与\")).concat(keyword).concat(_this3.$t(\"相关的商品\")));\n            _this3.isEmpty = true;\n            return;\n          }\n          _this3.isEmpty = false;\n          _this3.listData = pageList;\n          _this3.tipsData = _toConsumableArray(pageList);\n        }).catch(function (err) {\n          // Toast(err.message)\n        });\n      } else {\n        this.tipsShow = false;\n        this.listShow = false;\n        this.shopShow = false;\n      }\n    },\n    emptyHandle() {\n      this.$store.dispatch(\"clearSearchHistory\");\n      localStorage.removeItem(this.$route.query.sellerId);\n      this.searchHistory2 = [];\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}