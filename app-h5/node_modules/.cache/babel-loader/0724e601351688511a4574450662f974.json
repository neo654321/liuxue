{"ast":null,"code":"import _regeneratorRuntime from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/neo/Desktop/mallV2/app-h5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport _Option2 from \"element-ui/lib/theme-chalk/option.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Option from \"element-ui/lib/option\";\nimport _Select2 from \"element-ui/lib/theme-chalk/select.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Select from \"element-ui/lib/select\";\nimport \"vant/es/uploader/style\";\nimport _Uploader from \"vant/es/uploader\";\nimport _Input2 from \"element-ui/lib/theme-chalk/input.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Input from \"element-ui/lib/input\";\nimport _FormItem2 from \"element-ui/lib/theme-chalk/form-item.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _FormItem from \"element-ui/lib/form-item\";\nimport _Form2 from \"element-ui/lib/theme-chalk/form.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Form from \"element-ui/lib/form\";\nimport \"vant/es/button/style\";\nimport _Button from \"vant/es/button\";\nimport \"vant/es/checkbox/style\";\nimport _Checkbox from \"vant/es/checkbox\";\nimport _Dropdown2 from \"element-ui/lib/theme-chalk/dropdown.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _Dropdown from \"element-ui/lib/dropdown\";\nimport _DropdownItem2 from \"element-ui/lib/theme-chalk/dropdown-item.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _DropdownItem from \"element-ui/lib/dropdown-item\";\nimport _DropdownMenu2 from \"element-ui/lib/theme-chalk/dropdown-menu.css\";\nimport \"element-ui/lib/theme-chalk/base.css\";\nimport _DropdownMenu from \"element-ui/lib/dropdown-menu\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { uploadimg } from \"@/API/commodity\";\nimport { apiApplyLoan, apiApplyLoanConfig, apiBeforereApply, apiListCountry } from '@/API/loan';\nimport { priceFormat, getStorage, isAlphanumeric } from '@/utils/utis';\nexport default {\n  data() {\n    var _this$$route$query;\n    return {\n      mainColor: process.env.VUE_APP_MAIN_COLOR,\n      isAlphanumeric,\n      creditPeriodList: [],\n      lendableDays: [],\n      defaultRate: [],\n      amountMax: '',\n      amountMin: '',\n      rate: '',\n      //\n      priceFormat,\n      getStorage,\n      isCutting: false,\n      // 是否裁剪\n      imgFile: '',\n      ratioWidth: 1,\n      // 裁剪比例：长 自由比例设置为: 0 即可\n      ratioHeight: 1,\n      // 裁剪比例：宽 自由比例设置为: 0 即可\n      step: 1,\n      checked: false,\n      screenWidth: document.body.clientWidth,\n      type: 'Email',\n      //Email/Moblie\n      uploadCheckIndex: 1,\n      areaCode: 1,\n      isAgree: false,\n      countryName: '',\n      ruleForm: {\n        // loanMethod: this.$t('账户余额'),\n        creditPeriod: '',\n        realName: '',\n        imgCertificateFace: '',\n        imgCertificateBack: '',\n        imgCertificateHand: '',\n        // interestRate: '2%',\n        countryId: '',\n        applyAmount: '',\n        identification: ''\n      },\n      labelPosition: 'top',\n      isCode: true,\n      rules: {\n        identification: [{\n          required: true,\n          message: this.$t('请输入证件号码或者护照号'),\n          trigger: 'blur'\n        }],\n        imgCertificateFace: [{\n          required: true,\n          message: this.$t('请上传身份证正面'),\n          trigger: 'blur'\n        }],\n        imgCertificateBack: [{\n          required: true,\n          message: this.$t('请上传身份证反面'),\n          trigger: 'blur'\n        }],\n        imgCertificateHand: [{\n          required: true,\n          message: this.$t('请上传手持身份证'),\n          trigger: 'blur'\n        }],\n        realName: [{\n          required: true,\n          message: this.$t('请输入真实姓名'),\n          trigger: 'blur'\n        }, {\n          pattern: /^\\S.*\\S$|(^\\S{0,1}\\S$)/,\n          message: this.$t('首尾不能为空格'),\n          trigger: 'blur'\n        }],\n        applyAmount: [{\n          required: true,\n          message: this.$t('请输入金额'),\n          trigger: 'blur'\n        }],\n        creditPeriod: [{\n          required: true,\n          message: this.$t('请选择贷款期限'),\n          trigger: 'change'\n        }],\n        countryId: [{\n          required: true,\n          message: this.$t('请选择国家'),\n          trigger: 'change'\n        }]\n      },\n      options: [{\n        label: this.$t('身份证'),\n        value: '身份证'\n      }, {\n        label: this.$t('护照'),\n        value: '护照'\n      }],\n      fileList1: [],\n      fileList2: [],\n      fileList3: [],\n      fileList4: [],\n      tabList: [this.$t('电子邮箱'), this.$t('手机号')],\n      tabIndex: 0,\n      lang: [{\n        title: '简体中文',\n        key: 'cn',\n        icon: require('@/assets/image/language/cn.png')\n      }, {\n        title: 'English',\n        key: 'en',\n        icon: require('@/assets/image/language/usa.png')\n      }, {\n        title: '繁体中文',\n        key: 'tw',\n        icon: require('@/assets/image/language/tw.png')\n      }],\n      countryList: [],\n      pageDiaCode: true,\n      creditId: ((_this$$route$query = this.$route.query) === null || _this$$route$query === void 0 ? void 0 : _this$$route$query.creditId) || null\n    };\n  },\n  components: {\n    // NationalityList,\n    [_DropdownMenu.name]: _DropdownMenu,\n    [_DropdownItem.name]: _DropdownItem,\n    [_Dropdown.name]: _Dropdown,\n    [_Checkbox.name]: _Checkbox,\n    [_Button.name]: _Button,\n    [_Form.name]: _Form,\n    [_FormItem.name]: _FormItem,\n    [_Input.name]: _Input,\n    [_Uploader.name]: _Uploader,\n    [_Select.name]: _Select,\n    [_Option.name]: _Option,\n    [_Toast.name]: _Toast\n  },\n  created() {\n    this.requireApplyLoanConfig();\n    (this === null || this === void 0 ? void 0 : this.creditId) && this.requireBeforereApply(this.creditId);\n    this.requestGetCountryList();\n  },\n  methods: {\n    // 获取国家\n    requestGetCountryList() {\n      var _this = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _yield$apiListCountry, data;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return apiListCountry();\n            case 2:\n              _yield$apiListCountry = _context.sent;\n              data = _yield$apiListCountry.data;\n              _this.countryList = data;\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee);\n      }))();\n    },\n    onCountryChange(id) {\n      this.ruleForm.countryId = id;\n    },\n    requireApplyLoanConfig() {\n      var _this2 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return apiApplyLoanConfig();\n            case 2:\n              res = _context2.sent;\n              res.allLendableDays.forEach(function (x) {\n                res.lendableDays.forEach(function (y) {\n                  _this2.creditPeriodList.push({\n                    label: x + _this2.$t('天'),\n                    value: x,\n                    dis: x !== y\n                  });\n                });\n              });\n              _this2.creditPeriodList = _this2.deduplication(_this2.creditPeriodList, 'value');\n              _this2.creditPeriodList.forEach(function (x) {\n                res.lendableDays.forEach(function (y) {\n                  if (x.value == y) {\n                    x.dis = false;\n                  }\n                });\n              });\n              _this2.lendableDays = res.lendableDays;\n              _this2.amountMax = res.amountMax;\n              _this2.amountMin = res.amountMin;\n              _this2.rate = res.rate;\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }))();\n    },\n    requireBeforereApply(creditId) {\n      var _this3 = this;\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return apiBeforereApply({\n                creditId\n              });\n            case 2:\n              res = _context3.sent;\n              _this3.ruleForm.realName = res.realName;\n              _this3.ruleForm.applyAmount = res.applyAmount;\n              _this3.ruleForm.creditPeriod = res.creditPeriod + '';\n              _this3.handleSelectChange(res.creditPeriod + '');\n              _this3.rate = res.creditRate;\n              _this3.ruleForm.countryId = res.countryId;\n              _this3.ruleForm.identification = res.identification;\n              _this3.ruleForm.imgCertificateFace = res.imgCertificateFace;\n              _this3.ruleForm.imgCertificateBack = res.imgCertificateBack;\n              _this3.ruleForm.imgCertificateHand = res.imgCertificateHand;\n            case 13:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3);\n      }))();\n    },\n    deduplication(arr, name) {\n      var obj = {};\n      return arr.reduce(function (prev, cur) {\n        obj[cur[name]] ? '' : obj[cur[name]] = true && prev.push(cur);\n        return prev;\n      }, []);\n    },\n    handleJump() {\n      if (window.plus) {\n        window.plus.runtime.openURL(\"\".concat(window.origin, \"/promote/#/contract?lang=\").concat(getStorage('lang')));\n      } else {\n        window.open(\"\".concat(window.origin, \"/promote/#/contract?lang=\").concat(getStorage('lang')));\n      }\n    },\n    idCartChange() {\n      if (!this.isAlphanumeric(this.ruleForm.identification)) {\n        this.$notify(this.$t('证件号码/护照号码验证未通过'));\n        this.ruleForm.identification = '';\n      }\n    },\n    handleDelete(index) {\n      this[\"fileList\".concat(index)] = [];\n    },\n    // 提交申请贷款\n    requireSellerRegister() {\n      var _this4 = this;\n      this.$refs['ruleForm'].validate(function (valid) {\n        if (valid) {\n          if (!_this4.ruleForm.imgCertificateFace || !_this4.ruleForm.imgCertificateBack || !_this4.ruleForm.imgCertificateHand) {\n            // Toast(this.$t('请上传证件照片'))\n            _this4.$notify(_this4.$t('请上传证件照片'));\n          } else {\n            if (!_this4.isAgree) return _this4.$notify(_this4.$t('请阅读并同意借款协议'));\n            _this4.creditId && (_this4.ruleForm.creditId = _this4.creditId);\n            apiApplyLoan(_this4.ruleForm).then(function (res) {\n              _this4.$notify(_this4.$t('申请成功'), 'success');\n              _this4.$router.replace('/loan/my');\n            }).catch(function (err) {\n              console.log(\"err ::->\", err);\n            });\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    handleSelectChange(val) {\n      var day = this.lendableDays.find(function (x) {\n        return x == val;\n      });\n      !day && this.$notify(this.$t('未满足资质条件'));\n      !day && (this.ruleForm.creditPeriod = '');\n    },\n    // 申请金额不能大于最大值\n    handleInput() {\n      if (this.ruleForm.applyAmount > this.amountMax) {\n        this.ruleForm.applyAmount = this.amountMax;\n      } else if (this.ruleForm.applyAmount < 1) {\n        this.ruleForm.applyAmount = '';\n      }\n    },\n    // 申请金额不能小于最小值\n    handleChange() {\n      if (this.ruleForm.applyAmount < this.amountMin) {\n        this.ruleForm.applyAmount = '';\n        this.$notify(\"\".concat(this.$t('申请金额不能小于')).concat(this.amountMin));\n      }\n    },\n    openNationality(index) {\n      if (index === 1) {\n        this.isCode = true;\n      } else {\n        this.isCode = false;\n      }\n      this.$refs.controlChild.open();\n    },\n    //文件上传\n    afterRead2(file) {\n      var _this5 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      var formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      uploadimg(formData).then(function (data) {\n        _this5.ruleForm.imgCertificateFace = data;\n      }).catch(function (error) {\n        _this5.fileList2 = [];\n        _Toast.fail(_this5.$t('上传失败'));\n      }).finally(function () {\n        _Toast.clear();\n      });\n    },\n    //文件上传\n    afterRead3(file) {\n      var _this6 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      var formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      uploadimg(formData).then(function (data) {\n        _this6.ruleForm.imgCertificateBack = data;\n      }).catch(function (error) {\n        _this6.fileList3 = [];\n        _Toast.fail(_this6.$t('上传失败'));\n      }).finally(function () {\n        _Toast.clear();\n      });\n    },\n    //文件上传\n    afterRead4(file) {\n      var _this7 = this;\n      _Toast.loading({\n        duration: 0,\n        message: this.$t('上传中'),\n        forbidClick: true\n      });\n      var formData = new FormData(); //通过formdata上传\n      formData.append('file', file.file);\n      formData.append('moduleName', 'selle');\n      uploadimg(formData).then(function (data) {\n        _this7.ruleForm.imgCertificateHand = data;\n      }).catch(function (error) {\n        _this7.fileList4 = [];\n        _Toast.fail(_this7.$t('上传失败'));\n      }).finally(function () {\n        _Toast.clear();\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module"}