{"ast":null,"code":"import _toConsumableArray from \"/Users/neo/Desktop/node/liuxue/app-h5/node_modules/.pnpm/@babel+runtime@7.20.7/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _objectSpread from \"/Users/neo/Desktop/node/liuxue/app-h5/node_modules/.pnpm/@babel+runtime@7.20.7/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"vant/es/toast/style\";\nimport _Toast from \"vant/es/toast\";\nimport \"vant/es/empty/style\";\nimport _Empty from \"vant/es/empty\";\nimport \"vant/es/icon/style\";\nimport _Icon from \"vant/es/icon\";\nimport \"vant/es/list/style\";\nimport _List from \"vant/es/list\";\nimport \"vant/es/search/style\";\nimport _Search from \"vant/es/search\";\nimport \"vant/es/pull-refresh/style\";\nimport _PullRefresh from \"vant/es/pull-refresh\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.set.js\";\nimport \"core-js/modules/es.string.trim.js\";\nimport \"core-js/modules/esnext.set.difference.v2.js\";\nimport \"core-js/modules/esnext.set.intersection.v2.js\";\nimport \"core-js/modules/esnext.set.is-disjoint-from.v2.js\";\nimport \"core-js/modules/esnext.set.is-subset-of.v2.js\";\nimport \"core-js/modules/esnext.set.is-superset-of.v2.js\";\nimport \"core-js/modules/esnext.set.symmetric-difference.v2.js\";\nimport \"core-js/modules/esnext.set.union.v2.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport GoodsContentOne from \"@/components/GoodsContentOne/index.vue\";\nimport ShopContentTwo from \"@/components/ShopContentTwo/index.vue\";\nimport { mapGetters } from \"vuex\";\nimport debounce from \"lodash.debounce\";\nimport { searchKeyword, searchKeywordGoods, searchSeller, apiSearchSellerGoods } from \"@/API/common\";\nexport default {\n  name: \"Search\",\n  components: {\n    [_PullRefresh.name]: _PullRefresh,\n    [_Search.name]: _Search,\n    [_List.name]: _List,\n    [_Icon.name]: _Icon,\n    [_Empty.name]: _Empty,\n    [_Toast.name]: _Toast,\n    GoodsContentOne,\n    ShopContentTwo\n  },\n  data() {\n    return {\n      searchIcon: require(\"@/assets/image/index/sousuo.png\"),\n      clearIcon: require(\"@/assets/image/index/shanchu.png\"),\n      keyword: \"\",\n      tipsShow: false,\n      tipsData: [],\n      shopData: [],\n      shopShow: false,\n      listData: [],\n      listShow: false,\n      listLoading: false,\n      loading: false,\n      finished: false,\n      refreshing: false,\n      pageNum: 1,\n      pageSize: 20,\n      currentGoodsId: null,\n      searchHistory2: [],\n      isEmpty: false\n    };\n  },\n  computed: _objectSpread({}, mapGetters({\n    searchHistory: \"searchHistory\",\n    activeLang: \"language\"\n  })),\n  beforeRouteLeave(to, from, next) {\n    from.meta.keepAlive = Boolean(to.name === \"CommodityDetails\");\n    next();\n  },\n  mounted() {\n    this.searchHistory2 = JSON.parse(localStorage.getItem(this.$route.query.sellerId)) || [];\n    this.searchHistory2 = _toConsumableArray(new Set(this.searchHistory2));\n    this.tipsData = [];\n  },\n  methods: {\n    onRefresh() {\n      this.finished = false;\n      this.pageNum = 1;\n      this.loading = true;\n      this.onLoad();\n    },\n    onLoad() {\n      if (this.refreshing) {\n        this.list = [];\n        this.refreshing = false;\n      }\n      this.getListData();\n    },\n    getListData() {\n      var _this = this;\n      if (this.currentGoodsId) {\n        searchKeywordGoods({\n          goodsId: this.currentGoodsId,\n          pageNum: this.pageNum,\n          pageSize: this.pageSize\n        }).then(function (res) {\n          var pageList = res.pageList;\n          _this.listData = _this.pageNum === 1 ? pageList : [].concat(_toConsumableArray(_this.listData), _toConsumableArray(pageList));\n          _this.pageNum++;\n          _this.loading = false;\n          if (pageList.length < _this.pageSize) {\n            _this.finished = true;\n          }\n          _this.listLoading = false;\n          _Toast.clear();\n        }).catch(function () {\n          _this.loading = false;\n          _this.listLoading = false;\n          _Toast.clear();\n        });\n      } else {\n        this.listLoading = false;\n        this.finished = true;\n        _Toast.clear();\n        this.listData = [];\n      }\n    },\n    tipsHandle(data, isShop) {\n      var _this2 = this;\n      if (typeof data == \"string\") {\n        this.keyword = data;\n        this.searchHandle();\n        return;\n      }\n      if (isShop) {\n        this.shopShow = true;\n        this.tipsShow = false;\n        this.listShow = false;\n        searchSeller({\n          keyword: this.keyword,\n          isHot: \"0\",\n          isPrice: \"0\",\n          isNew: \"0\"\n        }).then(function (res) {\n          console.log(\"res ->\", res);\n          _this2.shopData = res.sellerList;\n        });\n      } else {\n        this.listShow = true;\n        this.tipsShow = false;\n        this.shopShow = false;\n        this.keyword = data.name;\n        this.currentGoodsId = data.goodsId;\n        this.$store.dispatch(\"setSearchHistory\", {\n          name: data.name,\n          goodsId: data.goodsId\n        });\n        _Toast.loading({\n          duration: 0,\n          message: this.$t(\"加载中\")\n        });\n        this.pageNum = 1;\n        this.finished = false;\n        this.loading = true;\n        this.listLoading = true;\n        this.refreshing = true;\n        this.listData = [];\n        this.onLoad();\n      }\n    },\n    clearHandle() {\n      this.tipsShow = false;\n      this.listShow = false;\n      this.shopShow = false;\n      this.keyword = \"\";\n    },\n    inputHandle: debounce(function () {\n      this.searchHandle();\n    }, 200),\n    searchHandle() {\n      var _this3 = this;\n      var keyword = String(this.keyword).trim();\n      if (keyword == \"\") return _Toast(this.$t(\"请输入搜索内容\"));\n      this.tipsShow = true;\n      this.listShow = false;\n      this.shopShow = false;\n      if (keyword) {\n        this.searchHistory2.push(keyword);\n        this.searchHistory2 = _toConsumableArray(new Set(this.searchHistory2));\n        localStorage.setItem(this.$route.query.sellerId, JSON.stringify(this.searchHistory2));\n        apiSearchSellerGoods({\n          keyword,\n          sellerId: this.$route.query.sellerId\n        }).then(function (res) {\n          // const { goodsList, sellerList } = res\n          var pageList = res.pageList,\n            pageInfo = res.pageInfo;\n          if (!pageList.length) {\n            _Toast(\"\".concat(_this3.$t(\"未找到与\")).concat(keyword).concat(_this3.$t(\"相关的商品\")));\n            _this3.isEmpty = true;\n            return;\n          }\n          _this3.isEmpty = false;\n          _this3.listData = pageList;\n          _this3.tipsData = _toConsumableArray(pageList);\n        }).catch(function (err) {\n          // Toast(err.message)\n        });\n      } else {\n        this.tipsShow = false;\n        this.listShow = false;\n        this.shopShow = false;\n      }\n    },\n    emptyHandle() {\n      this.$store.dispatch(\"clearSearchHistory\");\n      localStorage.removeItem(this.$route.query.sellerId);\n      this.searchHistory2 = [];\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmGA;AACA;AACA;AACA;AACA,SACAA,eACAC,oBACAC,cACAC,4BACA;AACA;EACAC;EACAC;IACA;IACA;IACA;IACA;IACA;IACA;IACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC,4BACAC;IACAC;IACAC;EACA,GACA;EACAC;IACAC;IACAC;EACA;EACAC;IACA,sBACAC;IACA;IACA;EACA;EACAC;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;QACA;QACA;MACA;MACA;IACA;IACAC;MAAA;MACA;QACAtC;UACAuC;UACAlB;UACAC;QACA,GACAkB;UACA;UACA,iBACA;UACA;UACA;UACA;YACA;UACA;UACA;UACA;QACA,GACAC;UACA;UACA;UACA;QACA;MACA;QACA;QACA;QACA;QACA;MACA;IACA;IACAC;MAAA;MACA;QACA;QACA;QACA;MACA;MACA;QACA;QACA;QACA;QACAzC;UACAS;UACAiC;UACAC;UACAC;QACA;UACAC;UACA;QACA;MACA;QACA;QACA;QACA;QACA;QACA;QACA;UACA3C;UACAoC;QACA;QACA;UACAQ;UACAC;QACA;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;MACA;IACA;IACAC;MACA;MACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACA;QACA;QACA;QACAC,qBACA,4BACAlB,oCACA;QAEAhC;UACAQ;UACA2C;QACA,GACAb;UACA;UACA;YAAAc;UACA;YACA,iBACA,8DACA;YACA;YACA;UACA;UACA;UACA;UACA;QACA,GACAb;UACA;QAAA,CACA;MACA;QACA;QACA;QACA;MACA;IACA;IACAc;MACA;MACAH;MACA;IACA;EACA;AACA","names":["searchKeyword","searchKeywordGoods","searchSeller","apiSearchSellerGoods","name","components","GoodsContentOne","ShopContentTwo","data","searchIcon","clearIcon","keyword","tipsShow","tipsData","shopData","shopShow","listData","listShow","listLoading","loading","finished","refreshing","pageNum","pageSize","currentGoodsId","searchHistory2","isEmpty","computed","mapGetters","searchHistory","activeLang","beforeRouteLeave","from","next","mounted","JSON","methods","onRefresh","onLoad","getListData","goodsId","then","catch","tipsHandle","isHot","isPrice","isNew","console","duration","message","clearHandle","inputHandle","searchHandle","localStorage","sellerId","pageInfo","emptyHandle"],"sourceRoot":"src/page/storeSearch","sources":["index.vue"],"sourcesContent":["<template>\n  <div class=\"search-container\">\n    <van-nav-bar safe-area-inset-top\n      fixed\n      left-arrow\n      :right-text=\"$t('搜索')\"\n      @click-right=\"searchHandle\"\n      @click-left=\"$router.go(-1)\"\n    >\n      <template #title>\n        <van-search\n          v-model=\"keyword\"\n          shape=\"round\"\n          :clearable=\"false\"\n          :placeholder=\"$t('搜索店铺内商品')\"\n        >\n          <template #left-icon>\n            <img\n              :src=\"searchIcon\"\n              alt=\"\"\n              class=\"search-icon\"\n              @click=\"inputHandle\"\n            />\n          </template>\n          <template #right-icon>\n            <van-icon\n              v-if=\"keyword\"\n              name=\"cross\"\n              @click=\"clearHandle\"\n              size=\"14\"\n              color=\"#333333\"\n            />\n          </template>\n        </van-search>\n      </template>\n    </van-nav-bar>\n\n    <div style=\"width: 100%; height: 44px\"></div>\n\n    <div v-if=\"!tipsShow && !shopShow && !listShow\" class=\"search-history\">\n      <div class=\"title\">\n        <p>{{ $t(\"历史搜索\") }}</p>\n        <div v-if=\"searchHistory2.length\" class=\"clear\" @click=\"emptyHandle\">\n          <img :src=\"clearIcon\" alt=\"\" class=\"search-icon\" />\n          <p>{{ $t(\"清空\") }}</p>\n        </div>\n      </div>\n      <div v-if=\"searchHistory2.length\" class=\"content\">\n        <div\n          v-for=\"(item, index) in searchHistory2\"\n          :key=\"index\"\n          class=\"item\"\n          @click=\"tipsHandle(item, false)\"\n        >\n          <!-- {{ item.name }} -->\n          {{ item }}\n        </div>\n      </div>\n      <van-empty v-else :description=\"$t('暂无记录')\" />\n    </div>\n\n    <!-- <div v-if=\"tipsShow\" class=\"search-tips-content\">\n            <template v-if=\"tipsData.length\">\n                <div v-for=\"(item, index) in tipsData\" :key=\"index\" class=\"item\" @click=\"tipsHandle(item, item.isShop)\">\n                    <van-icon v-if=\"item.isShop\" name=\"shop-o\" size=\"18\" />\n                    <p>{{ item.name }}</p>\n                </div>\n            </template>\n            <van-empty v-else :description=\"$t('暂无数据')\" />\n        </div> -->\n\n    <div v-if=\"tipsShow\" class=\"search-result-content\">\n      <van-list v-model=\"loading\" :finished=\"finished\" :loading-text=\"$t('加载中')\" @load=\"onLoad\">\n        <div style=\"padding: 0 15px\">\n          <goods-content-one :goods-data=\"tipsData\" />\n          <van-empty\n            v-if=\"!tipsData.length && !listLoading && !loading\"\n            :description=\"$t('暂无数据')\"\n          />\n        </div>\n      </van-list>\n    </div>\n    <van-empty v-if=\"isEmpty\" :description=\"$t('暂无记录')\" />\n    <div v-if=\"shopShow\" class=\"shop-list-content\">\n      <div v-if=\"activeLang === 'en'\" class=\"tips\">\n        Find {{ shopData.length }} <span>\"{{ keyword }}</span\n        >\" related stores for you\n      </div>\n      <div v-else class=\"tips\">\n        {{ $t(\"为您找到\") }} <span>\"{{ keyword }}</span\n        >\" {{ $t(\"相关的店铺\") }} {{ shopData.length || 0 }} {{ $t(\"家\") }}\n      </div>\n      <shop-content-two :shop-data=\"shopData\"></shop-content-two>\n    </div>\n  </div>\n</template>\n\n<script>\n  import { Search, Icon, PullRefresh, List, Empty, Toast } from \"vant\";\n  import GoodsContentOne from \"@/components/GoodsContentOne/index.vue\";\n  import ShopContentTwo from \"@/components/ShopContentTwo/index.vue\";\n  import { mapGetters } from \"vuex\";\n  import debounce from \"lodash.debounce\";\n  import {\n    searchKeyword,\n    searchKeywordGoods,\n    searchSeller,\n    apiSearchSellerGoods,\n  } from \"@/API/common\";\n  export default {\n    name: \"Search\",\n    components: {\n      [PullRefresh.name]: PullRefresh,\n      [Search.name]: Search,\n      [List.name]: List,\n      [Icon.name]: Icon,\n      [Empty.name]: Empty,\n      [Toast.name]: Toast,\n      GoodsContentOne,\n      ShopContentTwo,\n    },\n    data() {\n      return {\n        searchIcon: require(\"@/assets/image/index/sousuo.png\"),\n        clearIcon: require(\"@/assets/image/index/shanchu.png\"),\n        keyword: \"\",\n        tipsShow: false,\n        tipsData: [],\n        shopData: [],\n        shopShow: false,\n        listData: [],\n        listShow: false,\n        listLoading: false,\n        loading: false,\n        finished: false,\n        refreshing: false,\n        pageNum: 1,\n        pageSize: 20,\n        currentGoodsId: null,\n        searchHistory2: [],\n        isEmpty: false,\n      };\n    },\n    computed: {\n      ...mapGetters({\n        searchHistory: \"searchHistory\",\n        activeLang: \"language\",\n      }),\n    },\n    beforeRouteLeave(to, from, next) {\n      from.meta.keepAlive = Boolean(to.name === \"CommodityDetails\");\n      next();\n    },\n    mounted() {\n      this.searchHistory2 =\n        JSON.parse(localStorage.getItem(this.$route.query.sellerId)) || [];\n      this.searchHistory2 = [...new Set(this.searchHistory2)];\n      this.tipsData = [];\n    },\n    methods: {\n      onRefresh() {\n        this.finished = false;\n        this.pageNum = 1;\n        this.loading = true;\n        this.onLoad();\n      },\n      onLoad() {\n        if (this.refreshing) {\n          this.list = [];\n          this.refreshing = false;\n        }\n        this.getListData();\n      },\n      getListData() {\n        if (this.currentGoodsId) {\n          searchKeywordGoods({\n            goodsId: this.currentGoodsId,\n            pageNum: this.pageNum,\n            pageSize: this.pageSize,\n          })\n            .then((res) => {\n              const { pageList } = res;\n              this.listData =\n                this.pageNum === 1 ? pageList : [...this.listData, ...pageList];\n              this.pageNum++;\n              this.loading = false;\n              if (pageList.length < this.pageSize) {\n                this.finished = true;\n              }\n              this.listLoading = false;\n              Toast.clear();\n            })\n            .catch(() => {\n              this.loading = false;\n              this.listLoading = false;\n              Toast.clear();\n            });\n        } else {\n          this.listLoading = false;\n          this.finished = true;\n          Toast.clear();\n          this.listData = [];\n        }\n      },\n      tipsHandle(data, isShop) {\n        if (typeof data == \"string\") {\n          this.keyword = data;\n          this.searchHandle();\n          return;\n        }\n        if (isShop) {\n          this.shopShow = true;\n          this.tipsShow = false;\n          this.listShow = false;\n          searchSeller({\n            keyword: this.keyword,\n            isHot: \"0\",\n            isPrice: \"0\",\n            isNew: \"0\",\n          }).then((res) => {\n            console.log(\"res ->\", res);\n            this.shopData = res.sellerList;\n          });\n        } else {\n          this.listShow = true;\n          this.tipsShow = false;\n          this.shopShow = false;\n          this.keyword = data.name;\n          this.currentGoodsId = data.goodsId;\n          this.$store.dispatch(\"setSearchHistory\", {\n            name: data.name,\n            goodsId: data.goodsId,\n          });\n          Toast.loading({\n            duration: 0,\n            message: this.$t(\"加载中\"),\n          });\n\n          this.pageNum = 1;\n          this.finished = false;\n          this.loading = true;\n          this.listLoading = true;\n          this.refreshing = true;\n          this.listData = [];\n          this.onLoad();\n        }\n      },\n      clearHandle() {\n        this.tipsShow = false;\n        this.listShow = false;\n        this.shopShow = false;\n        this.keyword = \"\";\n      },\n      inputHandle: debounce(function () {\n        this.searchHandle();\n      }, 200),\n      searchHandle() {\n        const keyword = String(this.keyword).trim();\n        if (keyword == \"\") return Toast(this.$t(\"请输入搜索内容\"));\n        this.tipsShow = true;\n        this.listShow = false;\n        this.shopShow = false;\n        if (keyword) {\n          this.searchHistory2.push(keyword);\n          this.searchHistory2 = [...new Set(this.searchHistory2)];\n          localStorage.setItem(\n            this.$route.query.sellerId,\n            JSON.stringify(this.searchHistory2)\n          );\n\n          apiSearchSellerGoods({\n            keyword,\n            sellerId: this.$route.query.sellerId,\n          })\n            .then((res) => {\n              // const { goodsList, sellerList } = res\n              const { pageList, pageInfo } = res;\n              if (!pageList.length) {\n                Toast(\n                  `${this.$t(\"未找到与\")}${keyword}${this.$t(\"相关的商品\")}`\n                );\n                this.isEmpty = true\n                return\n              }\n              this.isEmpty = false\n              this.listData = pageList;\n              this.tipsData = [...pageList];\n            })\n            .catch((err) => {\n              // Toast(err.message)\n            });\n        } else {\n          this.tipsShow = false;\n          this.listShow = false;\n          this.shopShow = false;\n        }\n      },\n      emptyHandle() {\n        this.$store.dispatch(\"clearSearchHistory\");\n        localStorage.removeItem(this.$route.query.sellerId);\n        this.searchHistory2 = [];\n      },\n    },\n  };\n</script>\n\n<style lang=\"scss\" scoped>\n  .search-container {\n    /deep/ .van-field__left-icon {\n      display: flex;\n      align-items: center;\n      width: 16px;\n      margin-right: 8px;\n\n      > img {\n        width: 100%;\n        height: auto;\n      }\n    }\n\n    /deep/ .van-nav-bar__left {\n      padding-right: 10px !important;\n    }\n\n    /deep/ .van-nav-bar__title {\n      width: 100% !important;\n      position: relative;\n    }\n\n    /deep/ .van-search {\n      padding: 0 !important;\n\n      .van-search__content {\n        background-color: #f6f6f6;\n      }\n    }\n\n    .search-btn {\n      font-size: 12px;\n      color: #333;\n    }\n\n    .search-history {\n      padding: 0 15px;\n\n      > .title {\n        padding: 25px 0;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        font-size: 16px;\n        color: #000;\n\n        > .clear {\n          display: flex;\n          align-items: center;\n\n          > img {\n            width: 14px;\n            height: auto;\n            margin-right: 5px;\n          }\n\n          > p {\n            font-size: 12px;\n            color: #333;\n          }\n        }\n      }\n\n      > .content {\n        overflow: hidden;\n        display: flex;\n        flex-wrap: wrap;\n        justify-content: flex-start;\n\n        &.no {\n          display: flex;\n          justify-content: center;\n          font-size: 14px;\n          color: #999;\n        }\n\n        > .item {\n          float: left;\n          padding: 8px 15px;\n          background-color: #f6f6f6;\n          border-radius: 5px;\n          color: #999;\n          font-size: 12px;\n          margin-right: 14px;\n          margin-bottom: 22px;\n          max-width: calc(100vw - 30px);\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n        }\n      }\n    }\n\n    .search-tips-content {\n      > .item {\n        padding: 23px 15px;\n        border-bottom: 1px solid #eee;\n        display: flex;\n        align-items: center;\n\n        .van-icon {\n          margin-right: 5px;\n        }\n\n        > p {\n          color: #333;\n          font-size: 12px;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          white-space: nowrap;\n        }\n      }\n    }\n\n    .shop-list-content {\n      padding: 20px 15px;\n\n      > .tips {\n        font-size: 12px;\n        color: #333;\n\n        > span {\n        //   color: var(--main-color);\n        color: var(--main-color);\n        }\n      }\n    }\n  }\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}